<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisis Unblocker</title>
    <!-- Changed default favicon -->
    <link rel="icon" id="faviconTag" href="https://cdn.creazilla.com/icons/3232649/unblock-icon-sm.png" type="image/png">

    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #4285f4;
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            cursor: pointer;
        }

        .nav {
            display: flex;
            gap: 15px;
            align-items: center;
            position: relative;
        }

        .nav button {
            padding: 8px 16px;
            background-color: white; /* White background when not selected */
            color: #0d6efd; /* Blue text when not selected */
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.3s;
            position: relative;
        }
        
        .nav button:hover {
            background-color: #e8e8e8; /* Light gray on hover */
        }
        
        .nav button.active {
            background-color: #0d6efd; /* Blue background when selected */
            color: white; /* White text when selected */
        }

        .nav .close-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            display: none;
            z-index: 10;
            line-height: 18px;
            text-align: center;
            padding: 0;
        }

        .nav button.has-close .close-btn {
            display: block;
        }

        #nav-home.has-close .close-btn {
            display: none;
        }

        #settingsButton {
            background: 0 0;
            border: 0;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        #settingsButton:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .main-content {
            flex: 1;
            min-height: 0; /* Allow it to shrink if needed */
            overflow: hidden; /* Prevent scrollbars */
        }
        
        /* Allow overflow for Website Loader */
        .main-content.website-loader-active {
            overflow: hidden;
        }
        
        /* Make sure the website loader app fills the main content area */
        .main-content .app-container.website-loader-app {
            height: 100%;
        }
        
        /* Robust iframe sizing for Website Loader */
        .app-container.website-loader-app.active {
            display: flex !important;
            flex-direction: row;
            width: 100%;
            height: 100%;
        }
        
        .app-container.website-loader-app.active > form {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            width: 100%; /* Ensure form takes full width */
            box-sizing: border-box; /* Include padding/gap in width */
            flex: 0 0 auto; /* Don't grow, don't shrink, auto width */
        }
        
        .app-container.website-loader-app.active #iframeContainer {
            flex: 1; /* Take up 80% of horizontal space */
            min-height: 0; /* Allow it to shrink if content is less */
            display: flex; /* Use flex to ensure iframe fills container */
            flex-direction: column; /* Ensure vertical layout */
            height: 100%;
            width: 80%;
        }
        
        .app-container.website-loader-app.active iframe {
            flex: 1; /* Ensure iframe takes up all available space in container */
            width: 100%; /* Ensure full width */
            height: 100%;
            min-height: 0;
        }
        
        .app-container.website-loader-app.active #savedUrls {
            flex: 0 0 20%; /* Take up 20% of horizontal space */
            max-height: 100%;
            overflow-y: auto;
            padding: 24px;
            box-sizing: border-box;
            border-left: 1px solid #e2e8f0;
        }
        
        /* Improve spacing for saved URLs section */
        #app-websites #savedUrls h3 {
            margin-top: 0;
            margin-bottom: 16px;
            text-align: left;
        }
        
        .website-loader-app .url-item {
            margin-bottom: 10px;
            padding: 14px 18px;
            display: flex;
            flex-direction: column;
        }
        
        /* Home screen responsive styles */
        #app-home {
            background: linear-gradient(135deg, #74ebd5, #ACB6E5);
        }
        
        .home-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 20px;
            background: transparent;
            width: 100%;
            max-width: none;
            margin: 0;
            box-sizing: border-box;
        }
        
        .home-grid {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            box-sizing: border-box;
        }
        
        /* Dark Mode Styles for Home Screen */
        .dark-mode #app-home {
            background: linear-gradient(135deg, #1a202c, #2d3748);
        }
        
        .dark-mode .home-container {
            color: #e2e8f0;
        }
        
        .dark-mode .home-title {
            color: #cbd5e0;
        }
        
        .dark-mode .home-card {
            background: #2d3748;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .dark-mode .home-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
        
        .dark-mode .home-card h3 {
            color: #e2e8f0;
        }
        
        .dark-mode .home-card p {
            color: #a0aec0;
        }
        
        /* Improved YouTube API Key Selector */
        #apiKeySelector {
            padding: 8px 12px;
            font-size: 14px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            background-color: white;
            color: #4a5568;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 150px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        #apiKeySelector:hover {
            border-color: #a0aec0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }
        
        #apiKeySelector:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
        }
        
        /* Dark Mode for API Key Selector */
        .dark-mode #apiKeySelector {
            background-color: #4a5568;
            color: #e2e8f0;
            border-color: #718096;
        }
        
        .dark-mode #apiKeySelector:hover {
            border-color: #a0aec0;
        }
        
        /* Improved Tab Preset Buttons */
        .tab-preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .tab-preset-buttons button {
            padding: 10px 16px;
            font-size: 14px;
            font-weight: 600;
            border: 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: linear-gradient(to right, #4299e1, #3182ce);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            min-width: 140px;
            text-align: center;
        }
        
        .tab-preset-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, #3182ce, #2c5282);
        }
        
        .tab-preset-buttons button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        /* Dark Mode for Tab Preset Buttons */
        .dark-mode .tab-preset-buttons button {
            background: linear-gradient(to right, #2b6cb0, #2c5282);
        }
        
        .dark-mode .tab-preset-buttons button:hover {
            background: linear-gradient(to right, #2c5282, #2a4365);
        }
        
        .home-title {
            color: #333;
            margin-bottom: 16px; /* Mobile value */
        }
        
        .home-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* Minimum 140px for mobile */
            gap: 10px; /* Mobile value */
            width: 100%;
            max-width: 1200px;
        }
        
        .home-card {
            background: white;
            padding: 14px; /* Mobile value */
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .home-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .card-icon {
            width: 56px; /* Mobile value */
            height: 56px;
            object-fit: contain;
            margin-bottom: 10px;
        }
        
        .home-card h3 {
            font-size: 1rem; /* Mobile value */
            margin: 8px 0 5px 0;
        }
        
        .home-card p {
            font-size: 0.85rem;
            color: #666;
            margin: 0;
        }
        
        /* Tablet styles (480px to 767px) */
        @media (min-width: 480px) and (max-width: 767px) {
            .home-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 columns on tablets */
                gap: 12px; /* Tablet gap */
            }
            
            .home-title {
                margin-bottom: 20px; /* Tablet value */
            }
            
            .card-icon {
                width: 64px; /* Tablet size */
                height: 64px;
            }
            
            .home-card {
                padding: 16px; /* Tablet padding */
            }
            
            .home-card h3 {
                font-size: 1.1rem; /* Tablet font size */
            }
        }
        
        /* Desktop styles (â‰¥768px) */
        @media (min-width: 768px) {
            .home-grid {
                grid-template-columns: repeat(3, 1fr); /* 3 columns on desktop */
                gap: 20px; /* Desktop gap */
            }
            
            .home-title {
                margin-bottom: 30px; /* Desktop value */
            }
            
            .card-icon {
                width: 80px; /* Desktop size */
                height: 80px;
            }
            
            .home-card {
                padding: 20px; /* Desktop padding */
            }
            
            .home-card h3 {
                font-size: 1.25rem; /* Desktop font size */
            }
        }
        
        /* Ensure minimum touch target size (44x44px) */
        .home-card {
            min-height: 120px; /* Adjusted to ensure minimum touch target with icon, text and padding */
        }

        .app-container {
            width: 100%;
            height: 100%;
            display: none;
        }

        .app-container.active {
            display: block;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: 0;
            box-sizing: border-box !important;
            display: block; /* Eliminate inline baseline gap */
        }

        .youtube-app {
            background-color: #f9f9f9;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: auto;
        }

        .youtube-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .youtube-header {
            background-color: #fff;
            padding: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px; /* Reduced gap to bring paste form closer */
        }

        .video-item {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .video-item:hover {
            transform: translateY(-5px);
        }

        .video-thumbnail {
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            position: relative;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            object-fit: cover;
        }

        .video-details {
            padding: 10px;
        }

        .video-title {
            font-size: 18px;
            margin-bottom: 5px;
            color: #333;
        }

        .video-description {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .search-form {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            width: 100%;
        }

        .search-form input[type="text"] {
            width: 70%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px 0 0 4px;
            box-sizing: border-box;
        }

        .search-form button {
            padding: 10px 20px;
            font-size: 16px;
            border: 0;
            background-color: #333;
            color: #fff;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }

        .video-player-container {
            margin-top: 10px; /* Reduced margin to bring closer to suggested videos */
            text-align: center;
            position: relative;
            z-index: 10;
        }
        
        .video-paste-form {
            margin-top: 5px; /* Reduced margin to bring closer to video grid */
            transition: all 0.3s ease;
            position: relative;
            z-index: 5;
        }
        
        .video-player {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            position: relative;
            border-radius: 12px; /* Add rounded edges */
            overflow: hidden; /* Ensure rounding is visible */
        }
        
        .video-player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 12px; /* Add rounded edges to iframe */
        }
        
        .video-paste-form {
            margin-top: 5px; /* Further reduced margin to bring closer to video player */
        }
        
        .video-paste-form {
            margin-top: 5px; /* Reduced margin to bring closer to video grid */
            transition: all 0.3s ease;
        }
        
        .video-paste-form.hidden {
            display: none !important;
            visibility: hidden !important;
            height: 0 !important;
            overflow: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
            opacity: 0;
        }
        
        /* Responsive adjustments for different screen sizes */
        @media (max-width: 768px) {
            .video-player {
                padding-bottom: 62.5%; /* Slightly taller aspect ratio for mobile */
            }
        }
        
        @media (max-width: 480px) {
            .video-player {
                padding-bottom: 75%; /* Even taller for very small screens */
            }
        }
        
        /* Ensure player never exceeds viewport boundaries */
        .youtube-container .video-player {
            max-width: 100%;
            max-height: 60vh; /* Limit height on larger screens */
        }
        
        .youtube-container .video-player iframe {
            max-width: 100%;
            max-height: 60vh;
        }

        .video-paste-form input[type="text"] {
            width: 60%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px 0 4px 0;
            box-sizing: border-box;
        }
        
        .video-paste-form button {
            padding: 10px 20px;
            font-size: 16px;
            border: 0;
            background-color: #333;
            color: #fff;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        /* Ensure minimal spacing between video player and paste form */
        .video-paste-form {
            margin-top: 10px; /* Further reduced margin */
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        .button {
            padding: 10px 20px;
            font-size: 16px;
            border: 0;
            background-color: #333;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .embed-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            border-radius: 12px; /* Add rounded edges */
            overflow: hidden; /* Ensure rounding is visible */
        }
        
        .embed-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 12px; /* Add rounded edges to iframe */
        }

        .website-loader-app {
            background-color: #f8fafc;
            color: #1e293b;
            box-sizing: border-box; /* Ensure padding is included in width/height */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .app-container.website-loader-app.active {
            display: flex !important;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
        
        .app-container.website-loader-app.active > form {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 0;
            flex-wrap: wrap;
            width: 100%; /* Ensure form takes full width */
            box-sizing: border-box; /* Include padding/gap in width */
            flex: 0 0 auto; /* Don't grow, don't shrink, auto width */
            padding: 24px;
        }
        
        .app-container.website-loader-app.active #errorMessage {
            padding: 24px;
            box-sizing: border-box;
            flex: 0 0 auto;
        }
        
        /* Create a container for iframe and savedUrls side by side */
        .app-container.website-loader-app.active {
            display: flex !important;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
        
        /* Container that holds both iframe and savedUrls */
        .app-container.website-loader-app.active > #iframeContainer,
        .app-container.website-loader-app.active > #savedUrls {
            height: calc((100% - 120px)/2); /* Split remaining space after form and error */
            width: 100%;
        }
        
        /* Use CSS Grid on the parent to arrange iframeContainer and savedUrls side by side */
        .app-container.website-loader-app.active {
            display: grid !important;
            grid-template-columns: 3fr 1fr; /* Make iframe take 3/4 of space, sidebar take 1/4 */
            grid-template-rows: auto 1fr;
            width: 100%;
            height: 100%;
            gap: 0;
        }
        
        .app-container.website-loader-app.active > form {
            grid-column: 1 / span 2; /* Span both columns */
            grid-row: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 0;
            flex-wrap: wrap;
            width: 100%; /* Ensure form takes full width */
            box-sizing: border-box; /* Include padding/gap in width */
            padding: 4px; /* Further reduced padding to bring iframe closer */
        }
        
        .app-container.website-loader-app.active #errorMessage {
            grid-column: 1 / span 2; /* Span both columns */
            grid-row: 2; /* Place error message in its own row */
            padding: 12px;
            box-sizing: border-box;
        }
        
        /* Update the grid template to account for the error message */
        .app-container.website-loader-app.active {
            display: grid !important;
            grid-template-columns: 3fr 1fr; /* Make iframe take 3/4 of space, sidebar take 1/4 */
            grid-template-rows: auto auto 1fr; /* Add row for error message */
            width: 100%;
            height: 100%;
            gap: 0;
        }
        
        /* Update the iframe and savedUrls to be in row 3 */
        .app-container.website-loader-app.active #iframeContainer {
            grid-row: 3;
        }
        
        .app-container.website-loader-app.active #savedUrls {
            grid-row: 3;
        }
        
        .app-container.website-loader-app.active #iframeContainer {
            grid-column: 1;
            grid-row: 3;
            min-height: 0; /* Allow it to shrink if content is less */
            display: flex; /* Use flex to ensure iframe fills container */
            flex-direction: column; /* Ensure vertical layout */
            width: 100%;
            padding: 0 !important; /* Remove padding to eliminate vertical offset */
            margin: 0 !important; /* Remove margin to eliminate vertical offset */
            box-sizing: border-box;
            border-radius: 12px 0 0 12px; /* Round left corners only */
            background-color: white;
            box-shadow: 0 6px 16px rgba(0, 0, 0.12);
            min-width: 0; /* Ensure it can shrink */
            flex: 1; /* Allow it to grow and fill available space */
        }
        
        .app-container.website-loader-app.active #iframeContainer iframe {
            flex: 1;
            width: 100%;
            height: 100%;
            min-height: 0;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin: 0 !important; /* Remove any margin */
        }
        
        .app-container.website-loader-app.active > form {
            grid-column: 1 / span 2; /* Span both columns */
            grid-row: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 0;
            flex-wrap: wrap;
            width: 100%; /* Ensure form takes full width */
            box-sizing: border-box; /* Include padding/gap in width */
            padding: 4px !important; /* Further reduced padding to bring iframe closer */
        }
        
        .app-container.website-loader-app.active #errorMessage {
            grid-column: 1 / span 2; /* Span both columns */
            grid-row: 2;
            padding: 4px 8px !important; /* Reduced padding */
            min-height: 0;
            box-sizing: border-box;
        }
        
        /* Force no gap in the grid */
        .app-container.website-loader-app.active {
            display: grid !important;
            grid-template-columns: 3fr 1fr; /* Make iframe take 3/4 of space, sidebar take 1/4 */
            grid-template-rows: auto auto 1fr; /* Add row for error message */
            width: 100%;
            height: 100%;
            gap: 0 !important; /* No gap between grid items */
        }
        
        .app-container.website-loader-app.active #savedUrls {
            border-radius: 0 12px 0; /* Round right corners of sidebar */
        }
        
        .dark-mode .app-container.website-loader-app.active #iframeContainer {
            border-radius: 12px 0 0 12px; /* Round left corners only in dark mode */
        }
        
        .dark-mode .app-container.website-loader-app.active #savedUrls {
            border-radius: 0 12px 12px 0; /* Round right corners of sidebar in dark mode */
        }
        
        .dark-mode .app-container.website-loader-app.active #iframeContainer {
            background-color: #2d3748;
            box-shadow: 0 6px 16px rgba(0, 0, 0.3);
        }
        
        .dark-mode .app-container.website-loader-app.active #iframeContainer iframe {
            border: 1px solid #4a5568;
        }
        
        .app-container.website-loader-app.active #savedUrls {
            grid-column: 2;
            grid-row: 3;
            display: flex;
            flex-direction: column; /* Critical for proper height calculation */
            height: 100%; /* Ensure it fills grid cell */
            min-height: 0; /* Ensure it can shrink if needed */
            overflow: hidden; /* Contain all content */
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            background-color: white;
            border-left: 1px solid #e2e8f0;
            box-shadow: -5px 0 15px -5px rgba(0,0,0.05);
            scrollbar-width: thin; /* Ensure proper scrollbar width */
        }
        
        .app-container.website-loader-app.active #savedUrls h3 {
            position: -webkit-sticky; /* For better browser compatibility */
            position: sticky;
            top: 0;
            margin: 0;
            padding: 8px 10px 5px 10px; /* Reduced padding for narrow sidebar */
            color: #334155;
            font-weight: 600;
            border-bottom: 1px solid #e2e8f0;
            background-color: white;
            z-index: 1000; /* Higher z-index to ensure it stays on top */
            font-size: 0.9rem; /* Smaller font for narrow sidebar */
            box-sizing: border-box;
            width: 100%; /* Ensure full width */
            display: block; /* Ensure it's displayed as block */
            margin-top: 0 !important; /* Ensure no top margin */
            position: sticky !important; /* Ensure sticky positioning is applied */
            top: 0 !important; /* Explicitly set top position */
        }
        
        .app-container.website-loader-app.active #urlList {
            flex: 1; /* Allow it to grow and fill remaining space */
            overflow-y: auto;
            padding: 8px 5px; /* Reduced padding for narrow sidebar */
        }
        
        .app-container.website-loader-app.active .url-item {
            background: #ffffff;
            margin-bottom: 8px; /* Reduced margin for narrow sidebar */
            padding: 8px 5px; /* Reduced padding for narrow sidebar */
            border-radius: 4px; /* Reduced border radius for narrow sidebar */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
            font-size: 0.8rem; /* Smaller font for narrow sidebar */
        }
        
        .app-container.website-loader-app.active .url-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            border-color: #cbd5e1;
        }
        
        .app-container.website-loader-app.active .url-item a {
            text-decoration: none;
            color: #2563eb;
            font-weight: 500; /* Reduced font weight for narrow sidebar */
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 5px; /* Reduced margin for narrow sidebar */
            display: block;
            font-size: 0.75rem; /* Smaller font for narrow sidebar */
        }
        
        .app-container.website-loader-app.active .url-item a:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }
        
        .app-container.website-loader-app.active .url-item button {
            background: linear-gradient(to right, #ef4444, #dc2626);
            color: white;
            border: 0;
            padding: 4px 6px; /* Reduced padding for narrow sidebar */
            border-radius: 4px; /* Reduced border radius for narrow sidebar */
            cursor: pointer;
            font-size: 0.7rem; /* Smaller font for narrow sidebar */
            font-weight: 500;
            min-width: 40px; /* Reduced width for narrow sidebar */
            transition: all 0.2s ease;
        }
        
        .app-container.website-loader-app.active .url-item button:hover {
            background: linear-gradient(to right, #dc2626, #b91c1c);
            transform: scale(1.05);
        }
        
        /* Scrollbar styling for WebKit browsers */
        .app-container.website-loader-app.active #urlList::-webkit-scrollbar {
            width: 6px;
        }
        
        .app-container.website-loader-app.active #urlList::-webkit-scrollbar-thumb {
            background-color: #cbd5e0;
            border-radius: 6px;
        }
        
        .app-container.website-loader-app.active #urlList::-webkit-scrollbar-thumb:hover {
            background-color: #a0aec0;
        }
        
        .app-container.website-loader-app.active #urlList::-webkit-scrollbar-track {
            background-color: transparent;
        }
        
        .app-container.website-loader-app.active #urlList::-webkit-scrollbar-corner {
            background-color: transparent;
        }
        
        .app-container.website-loader-app.active #urlList::-webkit-scrollbar-track-piece {
            background-color: transparent;
        }
        
        /* Ensure no green background for scrollbar */
        .app-container.website-loader-app.active #urlList::-webkit-scrollbar-track {
            background-color: transparent;
        }
        
        .app-container.website-loader-app.active #urlList::-webkit-scrollbar-track-piece {
            background-color: transparent;
        }
        
        /* Make sure the entire scrollbar area has no green background */
        .app-container.website-loader-app.active #urlList {
            scrollbar-width: thin; /* For Firefox */
            scrollbar-color: #cbd5e0 transparent; /* thumb color, track color */
        }
        
        /* Additional specific rule for website loader to ensure no green background */
        .app-container.website-loader-app.active #savedUrls {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 transparent;
        }
        
        /* Remove any potential green scrollbar background */
        .app-container.website-loader-app.active #savedUrls::-webkit-scrollbar {
            background-color: transparent;
        }
        
        .app-container.website-loader-app.active #savedUrls::-webkit-scrollbar-track {
            background-color: transparent;
        }
        
        .app-container.website-loader-app.active #savedUrls::-webkit-scrollbar-track-piece {
            background-color: transparent;
        }
        
        /* Dark mode styles */
        .dark-mode .app-container.website-loader-app.active #savedUrls {
            background-color: #2d3748;
            border-left: 1px solid #4a5568;
        }
        
        .dark-mode .app-container.website-loader-app.active #savedUrls h3 {
            color: #cbd5e0;
            border-bottom: 1px solid #4a5568;
            background-color: #2d3748;
        }
        
        .dark-mode .app-container.website-loader-app.active .url-item {
            background-color: #2d3748;
            border: 1px solid #4a5568;
        }
        
        .dark-mode .app-container.website-loader-app.active .url-item a {
            color: #63b3ed;
        }
        
        .dark-mode .app-container.website-loader-app.active .url-item a:hover {
            color: #4299e1;
        }
        
        .dark-mode .app-container.website-loader-app.active .url-item button {
            background: linear-gradient(to right, #e53e3e, #c53030);
        }
        
        .dark-mode .app-container.website-loader-app.active .url-item button:hover {
            background: linear-gradient(to right, #c53030, #9b2c2c);
        }
        
        /* Dark mode scrollbar styling */
        .dark-mode .app-container.website-loader-app.active #urlList::-webkit-scrollbar-thumb {
            background-color: #718096;
        }
        
        .dark-mode .app-container.website-loader-app.active #urlList::-webkit-scrollbar-thumb:hover {
            background-color: #a0aec0;
        }
        
        .dark-mode .app-container.website-loader-app.active #urlList::-webkit-scrollbar-track {
            background-color: transparent;
        }
        
        .dark-mode .app-container.website-loader-app.active #urlList::-webkit-scrollbar-corner {
            background-color: transparent;
        }

        .website-loader-app form {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            width: 100%; /* Ensure form takes full width */
            box-sizing: border-box; /* Include padding/gap in width */
            flex: 0 0 auto; /* Don't grow, don't shrink, auto width */
        }

        .website-loader-app input[type="text"] {
            flex: 1;
            min-width: 280px;
            padding: 12px 16px;
            font-size: 16px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            transition: border-color 0.3s, box-shadow 0.3s;
            background: white;
            box-sizing: border-box; /* Include padding in width */
        }

        .website-loader-app input[type="submit"],
        .website-loader-app button {
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 600;
            border: 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0; /* Prevent buttons from shrinking too much */
        }

        .website-loader-app input[type="submit"] {
            background: linear-gradient(to right, #2563eb, #1d4ed8);
            color: white;
            box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3);
        }

        .website-loader-app input[type="submit"]:hover {
            background: linear-gradient(to right, #5a6268, #495057);
            transform: translateY(-1px);
        }

        .website-loader-app button {
            background: linear-gradient(to right, #10b981, #059669);
            color: white;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
        }

        .website-loader-app button:hover {
            background: linear-gradient(to right, #5a6268, #495057);
            transform: translateY(-1px);
        }

        .website-loader-app #iframeContainer {
            width: 80%;
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 6px 16px rgba(0, 0, 0.12);
            border: 1px solid #e2e8f0;
            box-sizing: border-box; /* Include border in width */
        }
        
        .app-container.website-loader-app.active #iframeContainer {
            width: 80%;
            flex: 1; /* Take up 80% of horizontal space */
            min-height: 0; /* Allow it to shrink if content is less */
            display: flex; /* Use flex to ensure iframe fills container */
            flex-direction: column; /* Ensure vertical layout */
            height: 100%;
        }

        .website-loader-app iframe {
            width: 100%;
            border: 0;
        }
        
        .app-container.website-loader-app.active iframe {
            width: 100%; /* Ensure full width */
            height: 100%; /* Ensure full height */
            min-height: 0;
            flex: 1; /* Ensure iframe takes up all available space in container */
        }
        
        /* Remove duplicate height rules that conflict with grid layout */
        /* The height is handled by the grid layout defined earlier */
        .app-container.website-loader-app.active #iframeContainer {
            min-height: 0; /* Allow it to shrink if content is less */
            display: flex; /* Use flex to ensure iframe fills container */
            flex-direction: column; /* Ensure vertical layout */
            width: 100%;
            padding: 12px; /* Reduced padding to better utilize space */
            box-sizing: border-box;
            border-radius: 12px 0 0 12px; /* Round left corners only */
            background-color: white;
            box-shadow: 0 6px 16px rgba(0, 0, 0.12);
            min-width: 0; /* Ensure it can shrink */
            flex: 1; /* Allow it to grow and fill available space */
        }
        
        .app-container.website-loader-app.active #savedUrls {
            min-height: 0; /* Ensure it can shrink if needed */
            overflow: hidden; /* Contain all content */
            padding: 0;
            box-sizing: border-box;
            background-color: white;
            border-left: 1px solid #e2e8f0;
            box-shadow: -5px 0 15px -5px rgba(0,0,0.05);
            flex: 1; /* Allow it to grow and fill available space */
        }
        
        /* Make sure the main content area is properly set up for the website loader */
        .main-content.website-loader-active {
            overflow: hidden;
        }

        .website-loader-app #errorMessage {
            text-align: center;
            color: #ef4444;
            margin-top: 12px;
            font-weight: 600;
            display: none;
        }
        
        .app-container.website-loader-app.active #errorMessage {
            flex: 0 auto; /* Don't grow, don't shrink, auto height */
        }

        .website-loader-app #savedUrls {
            width: 20%; /* Sidebar width */
            box-sizing: border-box; /* Include padding in width */
        }
        
        .app-container.website-loader-app.active #savedUrls {
            flex: 0 0 20%; /* Take up 20% of horizontal space */
            max-height: 100%;
            overflow-y: auto;
            padding: 24px;
            box-sizing: border-box;
            border-left: 1px solid #e2e8f0;
        }

        .website-loader-app #savedUrls h3 {
            text-align: left;
            color: #334155;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .website-loader-app #urlList {
            list-style: none;
            padding: 0;
            width: 100%; /* Ensure full width */
            box-sizing: border-box; /* Include padding in width */
        }

        .website-loader-app .url-item {
            display: flex;
            justify-content: center; /* Center the inner container */
            align-items: center;
            background: white;
            padding: 14px 18px;
            margin-bottom: 10px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0.06);
            border: 1px solid #e2e8f0;
            width: 100%; /* Ensure full width */
            box-sizing: border-box; /* Include padding in width */
        }
        
        .website-loader-app .url-item a {
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .website-loader-app .url-item a {
            text-decoration: none;
            color: #2563eb;
            font-weight: 600;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 10px;
        }

        .website-loader-app .url-item a:hover {
            color: #1d4ed8;
            text-decoration: underline;
        }

        .website-loader-app .url-item button {
            background: linear-gradient(to right, #ef4444, #dc2626);
            color: white;
            border: 0;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 8px;
            min-width: 70px;
            align-self: flex-start;
        }
        
        .website-loader-app .url-item button[title="Rename"] {
            background: transparent !important;
            color: black !important;
        }
        
        .website-loader-app .url-item button[title="Download"] {
            background: transparent !important;
            color: black !important;
        }
        
        .website-loader-app .url-item button[title="Rename"]:hover {
            background: rgba(0, 0, 0, 0.1) !important;
        }
        
        .website-loader-app .url-item button[title="Download"]:hover {
            background: rgba(0, 0, 0, 0.1) !important;
        }
        
        /* Additional specific selector for the edit icon */
        #app-websites .url-item button[title="Rename"] {
            color: black !important;
            background: transparent !important;
        }
        
        /* Additional specific selector for the download icon */
        #app-websites .url-item button[title="Download"] {
            color: black !important;
            background: transparent !important;
        }

        .website-loader-app .url-item button:hover {
            background: linear-gradient(to right, #dc2626, #b91c1c);
            transform: scale(1.03);
        }

        footer {
            text-align: center;
            padding: 10px;
            background-color: #f0f2f5;
            color: #666;
            font-size: 14px;
        }

        #settingsMenu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 0;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            width: 95%;
            height: 90%;
            max-width: 1600px;
            max-height: 90vh;
            overflow: hidden;
            flex-direction: column;
        }

        #settingsMenuHeader {
            background: linear-gradient(to right, #4a5568, #2d3748);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2rem;
            font-weight: 700;
        }

        #settingsMenuContent {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        #settingsMenuTabs {
            width: 200px;
            background-color: #f5f5f5;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            padding-top: 10px;
        }
        
        /* Dark mode for settings menu */
        .dark-mode #settingsMenu {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        
        .dark-mode #settingsMenuHeader {
            background: linear-gradient(to right, #2d3748, #1a202c);
            color: #e2e8f0;
        }
        
        .dark-mode #settingsMenuTabs {
            background-color: #4a5568;
            border-right: 1px solid #718096;
        }
        
        .dark-mode .settings-tab-button {
            color: #cbd5e0;
        }
        
        .dark-mode .settings-tab-button:hover {
            background-color: #2b6cb0;
        }
        
        .dark-mode .settings-tab-button.active {
            background-color: #3182ce;
            color: white;
        }
        
        .dark-mode #settingsMenuPanels {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        
        .dark-mode #settingsMenuFooter {
            background-color: #4a5568;
            border-top: 1px solid #718096;
            color: #e2e8f0;
        }

        .settings-tab-button {
            padding: 12px 15px;
            background: 0 0;
            border: 0;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid #eee;
        }

        .settings-tab-button:hover {
            background-color: #e9e9e9;
        }

        .settings-tab-button.active {
            background-color: #4285f4;
            color: white;
        }

        #settingsMenuPanels {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .settings-panel {
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        #settingsMenuFooter {
            padding: 10px 20px;
            background-color: #f9f9f9;
            border-top: 1px solid #ddd;
            text-align: right;
        }

        #settingsMenuFooter button {
            padding: 8px 15px;
            margin-left: 10px;
            border: 0;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 700;
        }

        #saveSettingsMain {
            background-color: #0d6efd;
            color: white;
        }

        #closeSettingsMain {
            background-color: #dc3545;
            color: white;
        }

        #saveSettingsMain:hover {
            background-color: #0b5ed7;
        }

        #closeSettingsMain:hover {
            background-color: #bb2d3b;
        }

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .code-runner-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #f8f9fa;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
        }

        .code-runner-header {
            background: linear-gradient(to right, #3498db, #2c3e50);
            color: white;
            padding: 10px 15px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
        }

        .code-runner-main-content {
            display: flex;
            flex: 1;
            padding: 10px;
            gap: 10px;
            overflow: hidden;
        }

        .code-runner-editors-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 250px;
        }

        .code-runner-editor-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .code-runner-editor-header {
            background: linear-gradient(to right, #3498db, #2c3e50);
            color: white;
            padding: 8px 10px;
            font-weight: 600;
            font-size: .9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-runner-textarea {
            flex: 1;
            padding: 10px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 13px;
            border: 0;
            resize: 0;
            outline: 0;
            background-color: #f8f9fa;
            line-height: 1.4;
        }

        .code-runner-textarea:focus {
            background-color: #fff;
            box-shadow: inset 0 0 0 1px #3498db;
        }

        .code-runner-preview-container {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            min-width: 300px;
        }

        .code-runner-preview-header {
            background: linear-gradient(to right, #27ae60, #2c3e50);
            color: white;
            padding: 8px 10px;
            font-weight: 600;
            font-size: .9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #preview-frame-runner {
            flex: 1;
            width: 100%;
            border: 0;
            background-color: white;
        }

        .code-runner-controls {
            display: flex;
            justify-content: center;
            padding: 15px;
            gap: 10px;
            background-color: #f0f0f0;
            border-top: 1px solid #ddd;
        }

        .code-runner-btn {
            padding: 8px 15px;
            font-size: .9rem;
            font-weight: 600;
            border: 0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .code-runner-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .code-runner-run-btn {
            background: linear-gradient(to right, #6c757d, #5a6268);
            color: white;
        }

        .code-runner-clear-btn {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
        }

        .code-runner-save-btn {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
        }

        .code-runner-save-file-btn {
            background: linear-gradient(to right, #9b59b6, #8e44ad);
            color: white;
        }

        .patch-notes-content {
            max-height: none;
            overflow-y: visible;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .patch-notes-content h3 {
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-top: 20px;
        }

        .patch-notes-content ul {
            padding-left: 20px;
        }

        .patch-notes-content li {
            margin-bottom: 8px;
        }

        #custom-css-panel textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }

        .theme-option {
            margin-bottom: 10px;
        }

        .theme-option input[type="radio"] {
            margin-right: 8px;
        }

        .theme-option label {
            cursor: pointer;
        }

        .app-visibility-option {
            margin-bottom: 10px;
        }

        .app-visibility-option input[type="checkbox"] {
            margin-right: 8px;
        }

        .app-visibility-option label {
            cursor: pointer;
        }

        .system-info-item {
            margin-bottom: 10px;
        }

        .system-info-item strong {
            display: inline-block;
            width: 150px;
        }

        #exportData,
        #importData {
            width: 100%;
            height: 150px;
            font-family: monospace;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }

        /* Dark Mode Styles */
        .dark-mode {
            background-color: #121212 !important;
            color: #e0e0e0 !important;
        }

        .dark-mode .header {
            background-color: #1e1e1e !important;
            color: #e0e0e0 !important;
            border-bottom: 1px solid #2d2d2d;
        }

        .dark-mode .nav button {
            background-color: #555555; /* Dark gray background when not selected */
            color: #64b5f6; /* Light blue text when not selected */
            border: 1px solid #404040;
        }

        .dark-mode .nav button:hover {
            background-color: #666666;
        }

        .dark-mode .nav button.active {
            background-color: #0d6efd; /* Blue background when selected */
            color: white; /* White text when selected */
        }

        .dark-mode footer {
            background-color: #1e1e1e !important;
            color: #e0e0e0 !important;
            border-top: 1px solid #2d2d2d;
        }

        .dark-mode #appFullscreenBtn {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
            border: 1px solid #404040;
        }

        .dark-mode #darkModeToggle {
            background-color: #2d2d2d !important;
            color: #e0e0e0 !important;
            border: 1px solid #404040;
        }

        /* Settings Menu Dark Mode Styles */
        .dark-mode #settingsMenu {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #2d2d2d;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .dark-mode #settingsMenuHeader {
            background: linear-gradient(to right, #1a202c, #2d3748);
            color: #f5f5f5;
            border-bottom: 1px solid #2d2d2d;
        }

        .dark-mode #settingsMenuTabs {
            background-color: #121212;
            border-right: 1px solid #2d2d2d;
            color: #e0e0e0;
        }

        .dark-mode .settings-tab-button {
            background-color: #121212;
            color: #e0e0e0;
            border-bottom: 1px solid #2d2d2d;
        }

        .dark-mode .settings-tab-button:hover {
            background-color: #6c757d;
        }
        
        .dark-mode .settings-tab-button.active {
            background-color: #6c757d;
            color: #f5f5f5;
        }

        .dark-mode #settingsMenuPanels {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        .dark-mode .settings-panel {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        .dark-mode #settingsMenuFooter {
            background-color: #121212;
            border-top: 1px solid #2d2d2d;
            color: #e0e0e0;
        }

        .dark-mode #saveSettingsMain {
            background-color: #6c757d !important;
            color: white !important;
        }
        
        .dark-mode #saveSettingsMain:hover {
            background-color: #5a6268 !important;
        }
        
        .dark-mode #closeSettingsMain {
            background-color: #6c757d !important;
            color: white !important;
        }
        
        .dark-mode #closeSettingsMain:hover {
            background-color: #5a6268 !important;
        }

        /* Input fields dark mode */
        .dark-mode input[type="text"],
        .dark-mode input[type="url"],
        .dark-mode input[type="number"],
        .dark-mode input[type="submit"],
        .dark-mode textarea,
        .dark-mode select {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #404040;
        }

        .dark-mode input[type="text"]:focus,
        .dark-mode input[type="url"]:focus,
        .dark-mode input[type="number"]:focus,
        .dark-mode textarea:focus,
        .dark-mode select:focus {
            border-color: #5d8ac4;
            box-shadow: 0 0 0 2px rgba(93, 138, 196, 0.3);
        }

        /* Buttons dark mode */
        .dark-mode .button,
        .dark-mode button,
        .dark-mode input[type="submit"] {
            background-color: #6c757d;
            color: #f5f5;
            border: 1px solid #5a6268;
        }
        
        .dark-mode .button:hover,
        .dark-mode button:hover,
        .dark-mode input[type="submit"]:hover {
            background-color: #5a6268;
        }

        .dark-mode .button:disabled {
            background-color: #404040;
            color: #a0a0a0;
        }

        /* Home screen dark mode */
        .dark-mode #app-home {
            background: linear-gradient(135deg, #1a202c, #2d3748);
        }

        .dark-mode .home-container {
            color: #e2e8f0;
        }

        .dark-mode .home-title {
            color: #cbd5e0;
        }

        .dark-mode .home-card {
            background: #2d3748;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .dark-mode .home-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .dark-mode .home-card h3 {
            color: #e2e8f0;
        }

        .dark-mode .home-card p {
            color: #a0aec0;
        }

        /* Tab preset buttons dark mode */
        .dark-mode .tab-preset-buttons button {
            background: linear-gradient(to right, #5a6268, #495057);
            color: white;
        }
        
        .dark-mode .tab-preset-buttons button:hover {
            background: linear-gradient(to right, #495057, #343a40);
        }

        /* YouTube API selector dark mode */
        .dark-mode #apiKeySelector {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #404040;
        }

        .dark-mode #apiKeySelector:hover {
            border-color: #5d8ac4;
        }

        /* Website Loader Dark Mode Styles - Now Controlled by Global Dark Mode */
        .dark-mode .website-loader-app {
            background-color: #1212;
            color: #e0e0e0;
        }
        
        .dark-mode .website-loader-app form {
            background-color: #1e1e1e;
            color: #e0e0e0;
            border-bottom: 1px solid #2d2d2d;
        }
        
        .dark-mode .website-loader-app input[type="text"],
        .dark-mode .website-loader-app input[type="submit"],
        .dark-mode .website-loader-app button {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #404040;
        }
        
        .dark-mode .website-loader-app input[type="submit"]:hover,
        .dark-mode .website-loader-app button:hover {
            background-color: #6c757d;
        }
        
        .dark-mode .website-loader-app #errorMessage {
            color: #ff6b6b;
        }
        
        .dark-mode .website-loader-app #savedUrls {
            background-color: #1e1e1e;
            border-left: 1px solid #2d2d2d;
        }
        
        .dark-mode .website-loader-app #savedUrls h3 {
            color: #f5f5f5;
            border-bottom: 1px solid #2d2d2d;
        }
        
        .dark-mode .website-loader-app .url-item {
            background-color: #2d2d2d;
            border: 1px solid #404040;
            box-shadow: 0 2px 6px rgba(0, 0, 0.3);
        }
        
        .dark-mode .website-loader-app .url-item button[title="Rename"] {
            background: transparent !important;
            color: #64b5f6;
        }
        
        .dark-mode .website-loader-app .url-item button[title="Rename"]:hover {
            background: rgba(100, 181, 246, 0.1) !important;
        }
        
        .dark-mode .website-loader-app .url-item a {
            color: #64b5f6;
        }
        
        .dark-mode .website-loader-app .url-item a:hover {
            color: #90caf9;
            text-decoration: underline;
        }
        
        .dark-mode .website-loader-app .url-item button {
            background: linear-gradient(to right, #e53e3e, #c53030);
        }
        
        .dark-mode .website-loader-app .url-item button:hover {
            background: linear-gradient(to right, #c53030, #9b2c2c);
        }
        
        /* YouTube Tab Dark Mode Styles - Now Controlled by Global Dark Mode */
        .dark-mode .youtube-app {
            background-color: #121212;
            color: #e0e0e0;
        }
        
        .dark-mode .youtube-app .youtube-header {
            background-color: #1e1e1e;
            color: #e0e0e0;
            border-bottom: 1px solid #2d2d2d;
        }
        
        .dark-mode .youtube-app .video-grid {
            background-color: #121212;
        }
        
        .dark-mode .youtube-app .video-item {
            background-color: #1e1e1e;
            color: #e0e0e0;
            border: 1px solid #2d2d2d;
        }
        
        .dark-mode .youtube-app .video-title {
            color: #f5f5f5;
        }
        
        .dark-mode .youtube-app .video-description {
            color: #b0b0b0;
        }
        
        .dark-mode .youtube-app .search-form input[type="text"] {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #404040;
        }
        
        .dark-mode .youtube-app .search-form button,
        .dark-mode .youtube-app .button,
        .dark-mode .youtube-app .video-paste-form button {
            background-color: #6c757d;
            color: white;
            border: none;
        }
        
        .dark-mode .youtube-app .button:disabled {
            background-color: #404040;
        }
        
        .dark-mode .youtube-app .video-paste-form input[type="text"] {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #404040;
        }
        
        .dark-mode .youtube-app .embed-container iframe {
            background-color: #121212; /* Fallback for iframe background */
        }

        /* Code Runner Container Dark Mode */
        .dark-mode .code-runner-container {
            background-color: #1e1e;
            border: 1px solid #2d2d2d;
        }

        .dark-mode .code-runner-header {
            background: linear-gradient(to right, #2563eb, #3b82f6);
            color: white;
        }

        .dark-mode .code-runner-main-content {
            background-color: #1212;
        }

        .dark-mode .code-runner-editor-section {
            background: #1e1e1e;
            border: 1px solid #2d2d2d;
        }

        .dark-mode .code-runner-editor-header {
            background: linear-gradient(to right, #2563eb, #3b82f6);
            color: white;
        }

        .dark-mode .code-runner-textarea {
            background-color: #1e1e;
            color: #d4d4d4;
            border: 1px solid #2d2d2d;
        }

        .dark-mode .code-runner-textarea:focus {
            background-color: #252526;
            box-shadow: inset 0 0 1px #2563eb;
        }

        .dark-mode .code-runner-preview-container {
            background: #1e1e1e;
            border: 1px solid #2d2d2d;
        }

        .dark-mode .code-runner-preview-header {
            background: linear-gradient(to right, #6c757d, #5a6268);
            color: white;
        }

        .dark-mode .code-runner-controls {
            background-color: #2d2d2d;
            border-top: 1px solid #2d2d2d;
        }
        
        .dark-mode .code-runner-save-file-btn {
            background: linear-gradient(to right, #3498db, #2980b9); /* Changed from purple to blue for better visibility in dark mode */
            color: white;
        }

        /* Patch Notes Content Dark Mode */
        .dark-mode .patch-notes-content {
            background-color: #2d2d2d;
            border: 1px solid #2d2d2d;
            color: #e0e0e0;
            max-height: none;
            overflow-y: visible;
        }

        .dark-mode .patch-notes-content h3 {
            color: #f5f5f5;
            border-bottom: 1px solid #2d2d2d;
        }

        /* Theme Option Dark Mode */
        .dark-mode .theme-option label,
        .dark-mode .app-visibility-option label {
            color: #e0e0e0;
        }

        /* System Info Item Dark Mode */
        .dark-mode .system-info-item {
            color: #e0e0e0;
        }

        .dark-mode .system-info-item strong {
            color: #f5f5;
        }

        /* Export/Import Data Textarea Dark Mode */
        .dark-mode #exportData,
        .dark-mode #importData {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #404040;
        }

        /* Link styling for KeyboardEvent.code */
        #settingsMenu a[href="https://keycode.info"] {
            color: #800080; /* Purple in light mode */
        }
        
        .dark-mode #settingsMenu a[href="https://keycode.info"] {
            color: #64b5f6 !important; /* Blue in dark mode */
        }
        
        /* Scrollbar styling for dark mode */
        .dark-mode ::-webkit-scrollbar {
            width: 10px;
            background-color: #1e1e1e;
        }
        
        .dark-mode ::-webkit-scrollbar-thumb {
            background-color: #404040;
            border-radius: 5px;
        }
        
        .dark-mode ::-webkit-scrollbar-thumb:hover {
            background-color: #505050;
        }
        
        .dark-mode ::-webkit-scrollbar-track {
            background-color: #2d2d2d;
        }
        
        /* General scrollbar styles for light mode to prevent green background */
        ::-webkit-scrollbar {
            width: 10px;
            background-color: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background-color: #cbd5e0;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background-color: #a0aec0;
        }
        
        ::-webkit-scrollbar-track {
            background-color: #f1f1f1;
        }

        /* Fullscreen overrides */
        .code-runner-container:-webkit-full-screen {
            width: 100%;
            height: 100%;
        }

        .code-runner-container:-moz-full-screen {
            width: 100%;
            height: 100%;
        }

        .code-runner-container:fullscreen {
            width: 100%;
            height: 100%;
        }
    </style>
    <!-- Security Splash Screen -->
    <div id="securitySplash" style="position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:99999;display:block"></div>
</head>
<body>

    <div class="header">
        <h1 onclick="showApp('home')">Crisis Unblocker</h1>
        <div class="nav">
            <button onclick="showApp('home')" class="active" id="nav-home">Home<span class="close-btn" onclick="closeApp('home', event)">âœ•</span></button>
            <button onclick="showApp('youtube')" id="nav-youtube">YouTube<span class="close-btn" onclick="closeApp('youtube', event)">âœ•</span></button>
            <button onclick="showApp('HEXA')" id="nav-HEXA">HEXA<span class="close-btn" onclick="closeApp('HEXA', event)">âœ•</span></button>
            <button onclick="showApp('games')" id="nav-games">Games<span class="close-btn" onclick="closeApp('games', event)">âœ•</span></button>
            <button onclick="showApp('websites')" id="nav-websites">Websites<span class="close-btn" onclick="closeApp('websites', event)">âœ•</span></button>
            <button onclick="showApp('spotify')" id="nav-spotify">Spotify<span class="close-btn" onclick="closeApp('spotify', event)">âœ•</span></button>
            <button onclick="showApp('messages')" id="nav-messages">Messages<span class="close-btn" onclick="closeApp('messages', event)">âœ•</span></button>
            <button id="settingsButton" title="Settings">âš™ï¸</button>
        </div>
    </div>

    <div class="main-content">
        <div class="app-container active" id="app-home">
            <div class="home-container">
                <h2 class="home-title">Welcome to the Crisis Unblocker</h2>
                <div class="home-grid">
                    <div class="home-card" onclick="showApp('youtube')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/09/YouTube_full-color_icon_%282017%29.svg/2560px-YouTube_full-color_icon_%282017%29.svg.png" alt="YouTube" class="card-icon">
                        <h3>YouTube</h3>
                        <p>Search and watch videos</p>
                    </div>
                    <div class="home-card" onclick="showApp('HEXA')">
                        <img src="https://cdn-icons-png.flaticon.com/512/7239/7239994.png" alt="HEXA" class="card-icon">
                        <h3>HEXA</h3>
                        <p>Watch free movies and shows</p>
                    </div>
                    <div class="home-card" onclick="showApp('games')">
                        <img src="https://www.svgrepo.com/show/25606/unblocked-padlock.svg" alt="Games" class="card-icon">
                        <h3>Unblocked Games</h3>
                        <p>Do your work bro</p>
                    </div>
                    <div class="home-card" onclick="showApp('websites')">
                        <img src="https://cdn-icons-png.flaticon.com/256/4659/4659860.png" alt="Websites" class="card-icon">
                        <h3>Website Loader</h3>
                        <p>Browse (almost) any website</p>
                    </div>
                    <div class="home-card" onclick="showApp('spotify')">
                        <img src="https://m.media-amazon.com/images/I/51rttY7a+9L.png" alt="Spotify" class="card-icon">
                        <h3>Spotify</h3>
                        <p>Listen to music</p>
                    </div>
                    <div class="home-card" onclick="showApp('messages')">
                        <img src="https://cdn-icons-png.flaticon.com/512/9699/9699963.png" alt="Messages" class="card-icon">
                        <h3>Messages</h3>
                        <p>Talk to fellow Crisis users</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="app-container youtube-app" id="app-youtube">
            <div class="youtube-container">
                <div class="youtube-header">
                    <h1><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Logo_of_YouTube_%282015-2017%29.svg/2560px-Logo_of_YouTube_%282015-2017%29.svg.png" alt="YouTube Logo" width="100" height="56"></h1>
                </div>
                <div style="text-align: center; margin-bottom: 15px;">
                    <label for="apiKeySelector">Select YouTube API Key:</label>
                    <select id="apiKeySelector" onchange="changeApiKey">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="search-form">
                    <input type="text" id="searchQuery" placeholder="Enter search query">
                    <button onclick="searchVideos()">Search</button>
                </div>
                <div id="searchResults" class="video-grid" style="margin-bottom: 5px;"></div>
                <div class="video-paste-form" style="margin-top: 5px; margin-bottom: 15px; display: flex; justify-content: center; align-items: center; gap: 10px;">
                    <input type="text" id="videoIdInput" placeholder="Paste YouTube URL or video ID">
                    <button onclick="playVideoFromInput()">Play</button>
                </div>
                <div class="video-player-container">
                    <div class="video-player" id="videoPlayer"></div>
                </div>
            </div>
        </div>

        <div class="app-container" id="app-HEXA">
            <iframe src="" id="HEXAFrame"></iframe>
        </div>

        <div class="app-container" id="app-games">
            <iframe src="" id="gamesFrame"></iframe>
        </div>

        <div class="app-container website-loader-app" id="app-websites">
            <form id="loadForm" onsubmit="loadWebsite(); return false">
                <input type="text" id="urlInput" placeholder="Enter website URL" required>
                <input type="submit" value="Load Website">
                <button type="button" onclick="saveWebsite()">Save Website</button>
            </form>
            <div id="errorMessage">Failed to load website. Please try another URL.</div>
            <div id="iframeContainer">
                <iframe id="webFrame" src="" loading="eager" scrolling="yes"></iframe>
            </div>
            <div id="savedUrls">
                <h3>Saved Websites</h3>
                <ul id="urlList"></ul>
            </div>
        </div>

        <div class="app-container" id="app-spotify">
            <iframe src="" id="spotifyFrame"></iframe>
        </div>

        <div class="app-container" id="app-messages">
            <iframe src="https://pulsetext.lovable.app" id="messagesFrame"></iframe>
        </div>
    </div>

    <footer>
        <div style="display:flex;justify-content:space-between;align-items:center;height:100%;">
            <span>All apps contained in a single file</span>
            <button id="darkModeToggle" onclick="toggleDarkMode()" style="background:white;color:black;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border:none;border-radius:3px;font-size:14px;cursor:pointer;padding:0;margin:0 5px;" title="Toggle Dark Mode">ðŸŒ™</button>
            <button id="appFullscreenBtn" style="background:black;color:white;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border:none;border-radius:3px;font-size:14px;cursor:pointer;padding:0;margin:0;" title="Fullscreen current app">â›¶</button>
        </div>
    </footer>

    <div id="overlay" onclick="closeSettings()"></div>
    <div id="settingsMenu">
        <div id="settingsMenuHeader">
            <span>Settings</span>
            <span style="cursor:pointer" onclick="closeSettings()">âœ•</span>
        </div>
        <div id="settingsMenuContent">
            <div id="settingsMenuTabs">
                <button class="settings-tab-button active" data-tab="main">Main Settings</button>
                <button class="settings-tab-button" data-tab="patch">Patch Notes</button>
            </div>
            <div id="settingsMenuPanels">
                <div class="settings-panel active" id="main-settings-panel">
                    <h2>Main Settings</h2>
                    <label for="pageTitle">Page Title:</label>
                    <input type="text" id="pageTitle" placeholder="Enter new page title" style="width:100%;padding:8px;margin-bottom:15px;box-sizing:border-box;border:1px solid #ccc;border-radius:4px">
                    <label for="faviconUrl">Favicon URL:</label>
                    <input type="url" id="faviconUrl" placeholder="Enter new favicon URL (e.g., https://example.com/favicon.ico)" style="width:100%;padding:8px;margin-bottom:15px;box-sizing:border-box;border:1px solid #ccc;border-radius:4px">
                    <!-- Added Tab Presets Section -->
                    <h3>Tab Presets</h3>
                    <div class="tab-preset-buttons">
                        <button onclick="applyPreset('crisis')" style="background: linear-gradient(to right, #ef4444, #dc2626); color: white; box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);">Crisis Default</button>
                        <button onclick="applyPreset('classroom')">Load Google Classroom</button>
                        <button onclick="applyPreset('gmail')">Load Gmail</button>
                        <button onclick="applyPreset('eschool')">Load eSchoolData</button>
                    </div>
                    <!-- End Tab Presets Section -->
                    <h3>Security Splash Screen</h3>
                    <label for="fallbackUrl">Fallback Redirect URL:</label>
                    <input type="url" id="fallbackUrl" style="width:100%;padding:8px;margin-bottom:15px;box-sizing:border-box;border:1px solid #ccc;border-radius:4px">
                    <label for="splashWaitTime">Wait Time (seconds):</label>
                    <input type="number" id="splashWaitTime" min="1" max="10" style="width:80px;padding:8px;margin-bottom:15px;box-sizing:border-box;border:1px solid #ccc;border-radius:4px">
                    <label for="requiredKeyCode">Required Key (e.g., Enter, Space, KeyA):</label>
                    <input type="text" id="requiredKeyCode" placeholder="Enter" style="width:100%;padding:8px;margin-bottom:15px;box-sizing:border-box;border:1px solid #ccc;border-radius:4px">
                    <p style="font-size:0.9em;color:#cfcfcf;">Use standard <a href="https://keycode.info" target="_blank">KeyboardEvent.code</a> values (e.g., "Enter", "Space", "KeyK")</p>
                    <button id="panicButton" onclick="triggerPanic()" style="padding:10px 15px;background-color:#ff9800;color:white;border:0;border-radius:4px;cursor:pointer;font-weight:700;margin-top:20px">Panic Button (Redirect to Google Classroom)</button>
                </div>
                <div class="settings-panel" id="file-settings-panel">
                    <h2>File Editor (Developer Tool)</h2>
                    <p style="color:#666;margin-bottom:15px">Create and run HTML code directly within the browser.</p>
                    <div class="code-runner-container">
                        <div class="code-runner-main-content">
                            <div class="code-runner-editors-container">
                                <div class="code-runner-editor-section" style="flex:3">
                                    <div class="code-runner-editor-header">
                                        <span>HTML</span>
                                        <button id="fullscreenBtn" onclick="toggleFullscreen()" style="float:right;padding:4px 8px;font-size:.8rem;border-radius:4px;background-color:#3498db;color:white;border:0;cursor:pointer">â›¶</button>
                                    </div>
                                    <textarea class="code-runner-textarea" id="html-code-runner" placeholder="Enter your HTML here...">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;My Web Page&lt;/title&gt;
    &lt;style&gt;
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 50px;
        }
        h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        p {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto 30px;
        }
        .btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #ff5252;
            transform: scale(1.05);
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Welcome to My Website&lt;/h1&gt;
    &lt;p&gt;This is a sample page created with HTML and CSS. Click the button below to see some JavaScript in action!&lt;/p&gt;
    &lt;button class=&quot;btn&quot; onclick=&quot;showMessage()&quot;&gt;Click Me!&lt;/button&gt;
    &lt;div id=&quot;output&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</textarea>
                                </div>
                                <div class="code-runner-preview-container" style="flex:2">
                                    <div class="code-runner-preview-header">
                                        <span>Preview</span>
                                    </div>
                                    <iframe id="preview-frame-runner"></iframe>
                                </div>
                            </div>
                        </div>
                        <div class="code-runner-controls">
                            <button id="run-btn-runner" class="code-runner-btn code-runner-run-btn"><span>â–¶ï¸ Run Code</span></button>
                            <button id="clear-btn-runner" class="code-runner-btn code-runner-clear-btn"><span>ðŸ—‘ï¸ Clear All</span></button>
                            <button id="save-btn-runner" class="code-runner-btn code-runner-save-btn"><span>ðŸ’¾ Save to Browser</span></button>
                            <button id="save-file-btn-runner" class="code-runner-btn code-runner-save-file-btn"><span>ðŸ’¾ Save to File</span></button>
                        </div>
                    </div>
                </div>
                <div class="settings-panel" id="patch-settings-panel">
                    <h2>Patch Notes</h2>
                    <div class="patch-notes-content">
                        <h3>Version 1.3/TEST4.0 (Current)</h3>
                        <ul>
                            <li><strong>Dark Mode:</strong> Added a light/dark mode toggle button to the footer. Dark mode changes the header and footer colors along with the background color of the main content area and the youtube/website loader Tab.</li>
                            <li><strong>Security Splash Screen:</strong> Reduced the default wait time from 2 seconds to 1 second.</li>
                            <li><strong>Settings Menu:</strong> Removed the 'Appearance Settings', 'File (dev)', 'Functionality Settings', and 'User Experience Settings' tabs.</li>
                            <li><strong>YouTube API Key:</strong> Added a dropdown menu in the YouTube tab to select which API key to use with 5 keys.</li>
                            <li><strong>Website Loader:</strong> Removed the "Website Loader" heading and reordered elements (saved sites to the right of iframe)</li>
                            <li><strong>Home Screen Icons:</strong> Updated the YouTube icon</li>
                            <li><strong>Home Screen Icons:</strong> Added a spotify and messages tab</li>
                            <li><strong>Website Loader Layout:</strong> Moved the saved websites list below the iframe.</li>
                            <li><strong>YouTube Icon:</strong> Updated the YouTube icon on the home screen and in the tab.</li>
                            <li><strong>YouTube Tab:</strong> Made the YouTube header click no longer reload videos to save API tokens.</li>
                            <li><strong>YouTube Tab:</strong> Removed like button from youtube tab to save API tokens.</li>
                            <li><strong>Settings Menu:</strong> Removed double scrollbar bug in the patch notes section.</li>
                            <li><strong>Security Splash Screen:</strong> Added proper handling and custom splash screen if the Fallback URL input box is empty.</li>
                            <li><strong>Settings Menu:</strong> Added 3 tab presets in settings. Selecting a preset changes the Favicon, tab name, and Fallback URL</li>
                            <li><strong>NOTE:</strong> (Note, file size is inflated by dead code that will be removed in next release.)</li>

                        </ul>
                        <h3>Version 1.2/TEST3.5</h3>
                        <ul>
                            <li><strong>Settings Menu:</strong> Added multiple new tabs: Appearance, Functionality, User Experience, Info & Diagnostics.</li>
                            <li><strong>Appearance:</strong> Added Theme selector (Default, Dark, Green, Purple) and Custom CSS injection.</li>
                            <li><strong>Functionality:</strong> Added options to pre-load apps on startup and adjust memory management limits (YouTube ID/Token tracking).</li>
                            <li><strong>User Experience:</strong> Added options to hide specific app tabs, a debug mode toggle, and a reset settings button.</li>
                            <li><strong>Info & Diagnostics:</strong> Added system information display (User Agent, Platform, LocalStorage Size) and Export/Import settings functionality.</li>
                            <li><strong>Persistence:</strong> All new settings are saved to localStorage and loaded on page startup.</li>
                            <li><strong>App Visibility:</strong> Hidden apps are now properly managed in the navigation bar.</li>
                            <li><strong>Home Screen:</strong> Removed ChatGPT due to servers not supporting Crisis.</li>
                            <li><strong>Home Screen:</strong> Replaced ChatGPT with HEXA, a free movie and TV show streaming service.</li>
                        </ul>
                        <h3>Version 1.1/TEST3.3</h3>
                        <ul>
                            <li><strong>Title Change:</strong> Application title changed from "Multi-App Portal" to "Crisis Unblocker".</li>
                            <li><strong>Settings Menu:</strong> Added a dedicated settings menu accessible via a gear icon (âš™ï¸) in the header.</li>
                            <li><strong>Customization:</strong> Settings menu allows users to change the page/tab title and favicon dynamically.</li>
                            <li><strong>Panic Button:</strong> Added a "Panic Button" within the settings menu that redirects the user to Google Classroom (<code>https://classroom.google.com/h</code>).</li>
                            <li><strong>Developer Tools:</strong> Integrated the "HTML Code Runner" tool into a new "File (Dev)" section within the settings menu.</li>
                            <li><strong>UI Improvements:</strong> Refined the overall layout and styling of the main portal and integrated applications.</li>
                            <li><strong>Code Structure:</strong> Added the ability to close/unload tabs to significantly increase performance.</li>
                            <li><strong>Code Structure:</strong> Refactored code for better organization and maintainability.</li>
                        </ul>
                        <h3>Version 1.0/TEST2.2 (Original)</h3>
                        <ul>
                            <li><strong>Initial Release:</strong> Launched with core applications: Home, YouTube, ChatGPT, Unblocked Games, and Website Loader.</li>
                            <li><strong>Basic Functionality:</strong> Provided access to various online tools and resources within a single interface.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div id="settingsMenuFooter">
            <button id="saveSettingsMain" onclick="saveSettings()">Save Changes</button>
            <button id="closeSettingsMain" onclick="closeSettings()">Close</button>
        </div>
    </div>

    <script>
        // Define YouTube API keys array
        const YOUTUBE_API_KEYS = [
            'AIzaSyCjS-8uAsUI-BXrKDmfYzQL6zENsEepOJ8',
            'AIzaSyCn4Ei1NiiOWkAYqfakggXiqrJl2mj_Sz8',
            'AIzaSyBkNvwJqmHxsqN4Oy09_KqlZOHSBEE7wyc',
            'AIzaSyBiwy1X4nNdEdwbZRyBEEEfEwaSS2BOEVI',
            'AIzaSyBTSwieuxNmfAxw5YuYJJSCjymTzaNUVxM'
        ];

        // --- NEW: Functions to manage API Key Dropdown ---
        function populateApiKeyDropdown() {
            const selectElement = document.getElementById('apiKeySelector');
            selectElement.innerHTML = ''; // Clear existing options
            YOUTUBE_API_KEYS.forEach((_, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `Key ${index + 1}`;
                selectElement.appendChild(option);
            });
        }

        function changeApiKey() {
            const selectElement = document.getElementById('apiKeySelector');
            const newIndex = parseInt(selectElement.value);
            if (!isNaN(newIndex) && newIndex >= 0 && newIndex < YOUTUBE_API_KEYS.length) {
                localStorage.setItem('selectedYoutubeApiKeyIndex', newIndex);
                console.log('YouTube API Key changed to index:', newIndex, 'Key:', YOUTUBE_API_KEYS[newIndex]);
                // Optionally, re-fetch current results or suggest refreshing if needed
                // For now, just log the change.
            } else {
                console.warn('Invalid API key index selected:', newIndex);
            }
        }

        function getCurrentApiKey() {
            const savedIndex = parseInt(localStorage.getItem('selectedYoutubeApiKeyIndex'));
            const index = (!isNaN(savedIndex) && savedIndex >= 0 && savedIndex < YOUTUBE_API_KEYS.length) ? savedIndex : 0;
            return YOUTUBE_API_KEYS[index];
        }

        function rotateApiKey() {
            const currentIndex = parseInt(localStorage.getItem('selectedYoutubeApiKeyIndex')) || 0;
            const nextIndex = (currentIndex + 1) % YOUTUBE_API_KEYS.length;
            localStorage.setItem('selectedYoutubeApiKeyIndex', nextIndex);
            console.log('Switched to YouTube API key index:', nextIndex, 'Key:', YOUTUBE_API_KEYS[nextIndex]);
        }
        // --- END NEW ---

        (function() {
            const splash = document.getElementById('securitySplash');
            if (!splash) return;
            
            // Load settings or use defaults
            const fallbackUrl = localStorage.getItem('fallbackUrl') || '';
            // --- CHANGED DEFAULT WAIT TIME TO 1 ---
            const waitTime = parseInt(localStorage.getItem('splashWaitTime')) || 1;
            // --- END CHANGED ---
            const requiredKey = localStorage.getItem('requiredKeyCode') || 'Enter';
            
            // --- NEW: Apply custom title and favicon immediately ---
            const savedTitle = localStorage.getItem('customPageTitle');
            const savedFavicon = localStorage.getItem('customFaviconUrl');
            if (savedTitle) {
                document.title = savedTitle;
            } else {
                document.title = 'Crisis Unblocker'; // Set default title if not saved
            }
            if (savedFavicon) {
                document.getElementById('faviconTag').href = savedFavicon;
            } else {
                // Changed default favicon
                document.getElementById('faviconTag').href = 'https://cdn.creazilla.com/icons/3232649/unblock-icon-sm.png';
            }
            // --- NEW: Apply saved dark mode setting ---
            const isDarkMode = localStorage.getItem('darkModeEnabled') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }
            // --- END NEW ---
            
            let passed = false;
            const handleKeyDown = (e) => {
                if (e.code === requiredKey) {
                    if (typeof timeoutId !== 'undefined') {
                        clearTimeout(timeoutId);
                    }
                    passed = true;
                    splash.style.display = 'none';
                    document.removeEventListener('keydown', handleKeyDown);
                    if (typeof initializeApp === 'function') {
                        initializeApp(); // Proceed with normal app init
                    }
                }
            };
            
            let timeoutId;
            
            // Check if there's a fallback URL - if not, show custom splash screen but don't redirect on timeout
            if (!fallbackUrl) {
                // No fallback URL means show custom splash screen but don't redirect on timeout
                // Only hide splash screen when the required key is pressed
                document.addEventListener('keydown', handleKeyDown);
                
                // Create custom splash screen content
                // Format the key for display (e.g., "KeyK" becomes "K", "Enter" stays "Enter", "Space" stays "Space")
                let displayKey = requiredKey;
                if (requiredKey.startsWith('Key')) {
                    displayKey = requiredKey.substring(3); // Remove "Key" prefix to get the letter
                }
                
                splash.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; font-family: Arial, sans-serif;">
                        <h1 style="font-size: 2.5rem; margin-bottom: 20px;">Welcome to Crisis Unblocker</h1>
                        <p style="font-size: 1.2rem; margin-bottom: 30px; max-width: 600px;">Press <strong>${displayKey}</strong> to continue</p>
                        <div style="display: flex; justify-content: center; align-items: center; margin-top: 20px;">
                            <div style="width: 15px; height: 15px; background-color: white; border-radius: 50%; margin: 0 5px; animation: pulse 1.5s infinite;"></div>
                            <div style="width: 15px; height: 15px; background-color: white; border-radius: 50%; margin: 0 5px; animation: pulse 1.5s infinite; animation-delay: 0.3s;"></div>
                            <div style="width: 15px; height: 15px; background-color: white; border-radius: 50%; margin: 0 5px; animation: pulse 1.5s infinite; animation-delay: 0.6s;"></div>
                        </div>
                    </div>
                    <style>
                        @keyframes pulse {
                            0% { transform: scale(0.9); opacity: 0.7; }
                            50% { transform: scale(1.1); opacity: 1; }
                            100% { transform: scale(0.9); opacity: 0.7; }
                        }
                    </style>
                `;
            } else {
                // Add the keydown event listener only when we need the splash screen
                document.addEventListener('keydown', handleKeyDown);
                // Show the security splash screen and wait for the required key or timeout
                timeoutId = setTimeout(() => {
                    if (!passed) {
                        window.location.href = fallbackUrl;
                    }
                    // Only remove the event listener if it hasn't been removed already by key press
                    // We'll handle removal in the handleKeyDown function when the key is pressed
                }, waitTime * 1000);
            }
        })();
        
        // ===== ORIGINAL APP INITIALIZATION (now wrapped) =====
        function initializeApp() {
            // Load settings into UI fields (but title/favicon are already applied globally)
            const savedTitle = localStorage.getItem('customPageTitle');
            const savedFavicon = localStorage.getItem('customFaviconUrl');
            if (savedTitle) {
                document.getElementById('pageTitle').value = savedTitle; // Only update the input field
            } else {
                document.getElementById('pageTitle').value = 'Crisis Unblocker'; // Set default in input field if not saved
            }
            if (savedFavicon) {
                document.getElementById('faviconUrl').value = savedFavicon; // Only update the input field
                document.getElementById('faviconTag').href = savedFavicon; // Ensure favicon is set on page load
            } else {
                // Changed default favicon in input field
                document.getElementById('faviconUrl').value = 'https://cdn.creazilla.com/icons/3232649/unblock-icon-sm.png';
                document.getElementById('faviconTag').href = 'https://cdn.creazilla.com/icons/3232649/unblock-icon-sm.png';
            }
            
            // Load security splash settings into UI
            const fallbackUrl = localStorage.getItem('fallbackUrl') || '';
            // --- CHANGED DEFAULT LOADED VALUE TO 1 ---
            const splashWaitTime = localStorage.getItem('splashWaitTime') || 1;
            // --- END CHANGED ---
            const requiredKeyCode = localStorage.getItem('requiredKeyCode') || 'Enter';
            document.getElementById('fallbackUrl').value = fallbackUrl;
            document.getElementById('splashWaitTime').value = splashWaitTime;
            document.getElementById('requiredKeyCode').value = requiredKeyCode;
            
            // --- NEW: Populate and set initial value for API Key dropdown ---
            populateApiKeyDropdown();
            const savedApiKeyIndex = parseInt(localStorage.getItem('selectedYoutubeApiKeyIndex')) || 0;
            if (savedApiKeyIndex >= 0 && savedApiKeyIndex < YOUTUBE_API_KEYS.length) {
                document.getElementById('apiKeySelector').value = savedApiKeyIndex;
            } else {
                document.getElementById('apiKeySelector').value = 0; // Fallback to first key
                localStorage.setItem('selectedYoutubeApiKeyIndex', 0); // Ensure consistency
            }
            // --- END NEW ---
            
            const savedCSS = localStorage.getItem('customCSS') || '';
            document.getElementById('customCSSInput').value = savedCSS;
            if (savedCSS) applyCustomCSS(savedCSS);

            const savedPreloads = JSON.parse(localStorage.getItem('preloadApps')) || [];
            const maxIds = localStorage.getItem('maxDisplayedIds') || 100;
            const maxTokens = localStorage.getItem('maxPrevTokens') || 10;
            savedPreloads.forEach(appName => {
                const checkbox = document.getElementById(`preload-${appName}`);
                if (checkbox) checkbox.checked = true;
            });
            document.getElementById('maxDisplayedIds').value = maxIds;
            document.getElementById('maxPrevTokens').value = maxTokens;

            const savedHiddenApps = JSON.parse(localStorage.getItem('hiddenApps')) || [];
            const debugMode = localStorage.getItem('debugMode') === 'true';
            savedHiddenApps.forEach(appName => {
                const checkbox = document.getElementById(`hide-${appName}`);
                if (checkbox) checkbox.checked = true;
                const navButton = document.getElementById(`nav-${appName}`);
                if (navButton) navButton.style.display = 'none';
            });
            document.getElementById('debugMode').checked = debugMode;
            if (debugMode) console.log('Debug mode enabled.');

            updateSystemInfo();
            if (document.getElementById('app-websites').classList.contains('active')) updateSavedUrls();

            // --- NEW: Load saved Website Loader dark mode setting ---
            const savedWebsiteLoaderDarkMode = localStorage.getItem('websiteLoaderDarkMode') === 'true';
            const websitesApp = document.getElementById('app-websites');
            if (savedWebsiteLoaderDarkMode) {
                websitesApp.classList.add('website-loader-dark');
            }
            // --- END NEW ---

            // --- NEW: Load saved YouTube dark mode setting ---
            const savedYouTubeDarkMode = localStorage.getItem('youTubeDarkMode') === 'true';
            const youtubeApp = document.getElementById('app-youtube');
            if (savedYouTubeDarkMode) {
                youtubeApp.classList.add('youtube-app-dark');
            }
            // --- END NEW ---
            
        }

        // --- NEW: Function to toggle dark mode ---
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkModeEnabled', isDarkMode);
            // Update the theme style tag if necessary based on the active theme
            // This ensures dark mode overrides are applied correctly
            const selectedTheme = localStorage.getItem('selectedTheme') || 'default';
            applyTheme(selectedTheme); // Re-apply the base theme logic
            const customCSS = localStorage.getItem('customCSS') || '';
            if (customCSS) applyCustomCSS(customCSS); // Re-apply custom CSS logic
        }
        // --- END NEW ---


        // --- NEW: Function to reset YouTube tab state ---
        function resetYouTubeTab() {
            // Reset global YouTube state variables
            window.nextPageToken = '';
            window.prevPageTokens = [];
            window.displayedVideoIds = new Set();
            window.currentQuery = '';

            // Clear search results and player
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('videoPlayer').innerHTML = '';
            document.getElementById('searchQuery').value = '';
            document.getElementById('videoIdInput').value = '';
            document.getElementById('backButton').disabled = true;
            document.getElementById('nextButton').disabled = false;

            // Reset the API key selector to the default value
            const savedApiKeyIndex = parseInt(localStorage.getItem('selectedYoutubeApiKeyIndex')) || 0;
            if (savedApiKeyIndex >= 0 && savedApiKeyIndex < YOUTUBE_API_KEYS.length) {
                document.getElementById('apiKeySelector').value = savedApiKeyIndex;
            } else {
                document.getElementById('apiKeySelector').value = 0; // Fallback to first key
            }

            // Show the paste form again when resetting
            var pasteForm = document.querySelector('.video-paste-form');
            if (pasteForm) {
                pasteForm.style.display = 'flex';
                pasteForm.style.visibility = 'visible';
                pasteForm.style.position = 'static';  // Reset position to normal flow
                pasteForm.style.left = 'auto';  // Reset left position
            }

            // Reload suggested videos
            loadSuggestedVideosLazy();
        }
        // --- END NEW ---
        

        document.getElementById('searchQuery').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchVideos();
            }
        });

        document.getElementById('appFullscreenBtn').addEventListener('click', function() {
            const activeApp = document.querySelector('.app-container.active');
            if (!activeApp) return;
            let targetElement = activeApp;
            if (activeApp.id === 'app-websites') {
                const iframeContainer = activeApp.querySelector('#iframeContainer');
                if (iframeContainer) targetElement = iframeContainer;
            }
            if (targetElement.requestFullscreen) {
                targetElement.requestFullscreen();
            } else if (targetElement.webkitRequestFullscreen) {
                targetElement.webkitRequestFullscreen();
            } else if (targetElement.msRequestFullscreen) {
                targetElement.msRequestFullscreen();
            } else if (targetElement.mozRequestFullScreen) {
                targetElement.mozRequestFullScreen();
            }
        });

        function openSettings() {
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('settingsMenu').style.display = 'flex';
        }

        function closeSettings() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('settingsMenu').style.display = 'none';
        }

        function saveSettings() {
            const newTitle = document.getElementById('pageTitle').value.trim();
            const newFaviconUrl = document.getElementById('faviconUrl').value.trim();
            if (newTitle) {
                document.title = newTitle;
                localStorage.setItem('customPageTitle', newTitle);
            } else localStorage.removeItem('customPageTitle');

            if (newFaviconUrl) {
                document.getElementById('faviconTag').href = newFaviconUrl;
                localStorage.setItem('customFaviconUrl', newFaviconUrl);
            } else localStorage.removeItem('customFaviconUrl');

            // Save security splash settings
            const fallbackUrl = document.getElementById('fallbackUrl').value.trim();
            const splashWaitTime = document.getElementById('splashWaitTime').value || 1; // Update default save value
            const requiredKeyCode = document.getElementById('requiredKeyCode').value.trim() || 'Enter';
            if (fallbackUrl) {
                localStorage.setItem('fallbackUrl', fallbackUrl);
            } else {
                localStorage.setItem('fallbackUrl', ''); // Store empty string instead of removing
            }
            localStorage.setItem('splashWaitTime', splashWaitTime);
            localStorage.setItem('requiredKeyCode', requiredKeyCode);

            // --- NEW: Save dark mode preference ---
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkModeEnabled', isDarkMode);
            // --- END NEW ---

            const customCSS = document.getElementById('customCSSInput').value.trim();
            localStorage.setItem('customCSS', customCSS);
            applyCustomCSS(customCSS);

            const preloads = Array.from(document.querySelectorAll('input[name="preload-apps"]:checked')).map(cb => cb.value);
            const maxIds = document.getElementById('maxDisplayedIds').value;
            const maxTokens = document.getElementById('maxPrevTokens').value;
            localStorage.setItem('preloadApps', JSON.stringify(preloads));
            localStorage.setItem('maxDisplayedIds', maxIds);
            localStorage.setItem('maxPrevTokens', maxTokens);

            const hiddenApps = Array.from(document.querySelectorAll('input[name="hide-apps"]:checked')).map(cb => cb.value);
            const debugMode = document.getElementById('debugMode').checked;
            localStorage.setItem('hiddenApps', JSON.stringify(hiddenApps));
            localStorage.setItem('debugMode', debugMode);

            document.querySelectorAll('input[name="hide-apps"]').forEach(checkbox => {
                const appName = checkbox.value;
                const navButton = document.getElementById(`nav-${appName}`);
                if (navButton) navButton.style.display = checkbox.checked ? 'none' : '';
            });
            if (debugMode) console.log('Debug mode enabled.');
            else console.log('Debug mode disabled.');

            alert('Settings saved!');
        }

        // --- NEW: Function to apply tab presets ---
        function applyPreset(presetName) {
            let newTitle = '';
            let newFavicon = '';
            let newFallbackUrl = '';

            switch (presetName) {
                case 'classroom':
                    newTitle = 'Home';
                    newFavicon = 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/Google_Classroom_Logo.svg/2372px-Google_Classroom_Logo.svg.png';
                    newFallbackUrl = 'https://classroom.google.com/h';
                    break;
                case 'gmail':
                    newTitle = 'Lancaster Central School District Mail';
                    newFavicon = 'https://static.vecteezy.com/system/resources/previews/020/964/377/non_2x/gmail-mail-icon-for-web-design-free-png.png';
                    newFallbackUrl = 'https://mail.google.com';
                    break;
                case 'eschool':
                    newTitle = 'eSchoolData - StudentPortal';
                    newFavicon = 'https://github.com/jonasqjaros/Crisis-Unblocker/blob/main/download.png?raw=true';
                    newFallbackUrl = 'https://studentportal-wnyric.eschooldata.com/lancastercsd';
                    break;
                case 'crisis':
                    newTitle = 'Crisis Unblocker';
                    newFavicon = 'https://cdn.creazilla.com/icons/3232649/unblock-icon-sm.png';
                    newFallbackUrl = ''; // No security splash screen for Crisis default
                    break;
                default:
                    console.warn('Unknown preset:', presetName);
                    return;
            }

            // Update the page title and favicon
            document.title = newTitle;
            document.getElementById('faviconTag').href = newFavicon;

            // Update the input fields in the settings menu
            document.getElementById('pageTitle').value = newTitle;
            document.getElementById('faviconUrl').value = newFavicon;

            // Update the fallback URL in the settings menu
            if (newFallbackUrl) {
                document.getElementById('fallbackUrl').value = newFallbackUrl;
                localStorage.setItem('fallbackUrl', newFallbackUrl);
            } else {
                // For Crisis default, set the fallback URL to empty string to keep security splash screen active
                document.getElementById('fallbackUrl').value = '';
                localStorage.setItem('fallbackUrl', '');
            }

            // Save the changes to localStorage
            localStorage.setItem('customPageTitle', newTitle);
            localStorage.setItem('customFaviconUrl', newFavicon);

            console.log(`Applied preset: ${presetName}. Title: ${newTitle}, Favicon: ${newFavicon}, Fallback URL: ${newFallbackUrl}`);
        }
        // --- END NEW ---

        document.querySelectorAll('.settings-tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.settings-tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.settings-panel').forEach(panel => panel.classList.remove('active'));
                button.classList.add('active');
                const tabName = button.getAttribute('data-tab');
                document.getElementById(`${tabName}-settings-panel`).classList.add('active');
            });
        });

        function applyTheme(themeName) {
            let styleElement = document.getElementById('theme-styles');
            if (!styleElement) {
                const newStyle = document.createElement('style');
                newStyle.id = 'theme-styles';
                document.head.appendChild(newStyle);
            }
            document.getElementById('theme-styles').textContent = themeStyles[themeName] || '';
        }

        function applyCustomCSS(cssCode) {
            let styleElement = document.getElementById('custom-css-styles');
            if (!styleElement) {
                const newStyle = document.createElement('style');
                newStyle.id = 'custom-css-styles';
                document.head.appendChild(newStyle);
            }
            document.getElementById('custom-css-styles').textContent = cssCode || '';
        }

        function resetSettings() {
            if (confirm('Are you sure you want to reset ALL settings to their defaults? This cannot be undone.')) {
                localStorage.clear();
                location.reload();
            }
        }

        function updateSystemInfo() {
            document.getElementById('userAgentInfo').textContent = navigator.userAgent;
            document.getElementById('platformInfo').textContent = navigator.platform;
            let totalSize = 0;
            for (let key in localStorage)
                if (localStorage.hasOwnProperty(key)) totalSize += localStorage[key].length + key.length;
            document.getElementById('localStorageSizeInfo').textContent = `${totalSize} characters`;
            const activeApps = [];
            if (window.appInitialized)
                for (let app in window.appInitialized)
                    if (window.appInitialized[app]) activeApps.push(app);
            document.getElementById('activeAppsInfo').textContent = activeApps.join(', ') || 'None loaded yet';
        }

        function exportSettings() {
            
            const settingsObject = {
                customPageTitle: localStorage.getItem('customPageTitle'),
                customFaviconUrl: localStorage.getItem('customFaviconUrl'),
                selectedTheme: localStorage.getItem('selectedTheme'),
                customCSS: localStorage.getItem('customCSS'),
                preloadApps: JSON.parse(localStorage.getItem('preloadApps')) || [],
                maxDisplayedIds: localStorage.getItem('maxDisplayedIds'),
                maxPrevTokens: localStorage.getItem('maxPrevTokens'),
                hiddenApps: JSON.parse(localStorage.getItem('hiddenApps')) || [],
                debugMode: localStorage.getItem('debugMode') === 'true',
                darkModeEnabled: localStorage.getItem('darkModeEnabled') === 'true' // Include dark mode in export
            };
            const settingsString = JSON.stringify(settingsObject, null, 2);
            document.getElementById('exportData').value = settingsString;
            const blob = new Blob([settingsString], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'crisis_unblocker_settings.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function importSettings() {
            const inputString = document.getElementById('importData').value.trim();
            if (!inputString) {
                alert('Please paste exported settings into the text area.');
                return;
            }
            try {
                const settingsObject = JSON.parse(inputString);
                if (settingsObject.customPageTitle !== undefined) {
                    localStorage.setItem('customPageTitle', settingsObject.customPageTitle);
                    document.getElementById('pageTitle').value = settingsObject.customPageTitle;
                    document.title = settingsObject.customPageTitle;
                }
                if (settingsObject.customFaviconUrl !== undefined) {
                    localStorage.setItem('customFaviconUrl', settingsObject.customFaviconUrl);
                    document.getElementById('faviconUrl').value = settingsObject.customFaviconUrl;
                    document.getElementById('faviconTag').href = settingsObject.customFaviconUrl;
                }
                if (settingsObject.selectedTheme !== undefined) {
                    localStorage.setItem('selectedTheme', settingsObject.selectedTheme);
                    document.getElementById(`theme-${settingsObject.selectedTheme}`).checked = true;
                    applyTheme(settingsObject.selectedTheme);
                }
                if (settingsObject.customCSS !== undefined) {
                    localStorage.setItem('customCSS', settingsObject.customCSS);
                    document.getElementById('customCSSInput').value = settingsObject.customCSS;
                    applyCustomCSS(settingsObject.customCSS);
                }
                if (settingsObject.preloadApps !== undefined) {
                    localStorage.setItem('preloadApps', JSON.stringify(settingsObject.preloadApps));
                    settingsObject.preloadApps.forEach(appName => {
                        const checkbox = document.getElementById(`preload-${appName}`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                if (settingsObject.maxDisplayedIds !== undefined) {
                    localStorage.setItem('maxDisplayedIds', settingsObject.maxDisplayedIds);
                    document.getElementById('maxDisplayedIds').value = settingsObject.maxDisplayedIds;
                }
                if (settingsObject.maxPrevTokens !== undefined) {
                    localStorage.setItem('maxPrevTokens', settingsObject.maxPrevTokens);
                    document.getElementById('maxPrevTokens').value = settingsObject.maxPrevTokens;
                }
                if (settingsObject.hiddenApps !== undefined) {
                    localStorage.setItem('hiddenApps', JSON.stringify(settingsObject.hiddenApps));
                    settingsObject.hiddenApps.forEach(appName => {
                        const checkbox = document.getElementById(`hide-${appName}`);
                        if (checkbox) checkbox.checked = true;
                        const navButton = document.getElementById(`nav-${appName}`);
                        if (navButton) navButton.style.display = 'none';
                    });
                }
                if (settingsObject.debugMode !== undefined) {
                    localStorage.setItem('debugMode', settingsObject.debugMode);
                    document.getElementById('debugMode').checked = settingsObject.debugMode;
                    if (settingsObject.debugMode) console.log('Debug mode enabled via import.');
                }
                if (settingsObject.darkModeEnabled !== undefined) { // Apply dark mode from import
                    localStorage.setItem('darkModeEnabled', settingsObject.darkModeEnabled);
                    document.body.classList.toggle('dark-mode', settingsObject.darkModeEnabled);
                    applyTheme(settingsObject.selectedTheme); // Re-apply theme to reflect dark mode
                    if (settingsObject.customCSS) applyCustomCSS(settingsObject.customCSS);
                }
                alert('Settings imported successfully! Please save and reload the page to see all changes.');
                updateSystemInfo();
            } catch (e) {
                alert('Error parsing imported settings. Please check the format.');
                console.error(e);
            }
        }

        function showApp(appName) {
            const hiddenApps = JSON.parse(localStorage.getItem('hiddenApps')) || [];
            if (hiddenApps.includes(appName)) {
                console.log(`App ${appName} is hidden.`);
                return;
            }
            
            // Check if the app is already active
            const isCurrentlyActive = document.getElementById(`app-${appName}`).classList.contains('active');
            
            document.querySelectorAll('.app-container').forEach(app => app.classList.remove('active'));
            document.getElementById(`app-${appName}`).classList.add('active');
            document.querySelectorAll('.nav button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`nav-${appName}`).classList.add('active');
            
            // Add special handling for Website Loader to enable scrolling
            if (appName === 'websites') {
                document.querySelector('.main-content').classList.add('website-loader-active');
            } else {
                document.querySelector('.main-content').classList.remove('website-loader-active');
            }
            
            if (!window.appInitialized) window.appInitialized = {};
            if (!window.appInitialized[appName]) {
                window.appInitialized[appName] = true;
                if (appName !== 'home') document.getElementById(`nav-${appName}`).classList.add('has-close');
                switch (appName) {
                    case 'youtube':
                        loadSuggestedVideosLazy();
                        break;
                    case 'HEXA':
                        document.getElementById('HEXAFrame').src = 'https://hexa.su/';
                        break;
                    case 'games':
                        document.getElementById('gamesFrame').src = 'https://geography-lessons-5.pro/#google_vignette';
                        break;
                    case 'websites':
                        document.querySelector('.main-content').classList.add('website-loader-active');
                        updateSavedUrls();
                        break;
                    case 'spotify':
                        document.getElementById('spotifyFrame').src = 'https://spottube.lovable.app';
                        break;
                    case 'messages':
                        document.getElementById('messagesFrame').src = 'https://pulsetext.lovable.app';
                        break // Added initialization for messages app
                }
            }
        }

        function loadSuggestedVideosLazy() {
            if (document.getElementById('app-youtube').classList.contains('active')) {
                // Show the paste form when loading suggested videos
                var pasteForm = document.querySelector('.video-paste-form');
                if (pasteForm) {
                    pasteForm.style.display = 'flex';
                    pasteForm.style.visibility = 'visible';
                    pasteForm.style.position = 'static';  // Reset position to normal flow
                    pasteForm.style.left = 'auto';  // Reset left position
                }
                fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&maxResults=8&key=${getCurrentApiKey()}`)
                .then(response => response.json())
                .then(data => {
                    nextPageToken = data.nextPageToken;
                    displayVideos(data.items);
                })
                .catch(error => console.error('Error fetching suggested videos:', error));
            }
        }

        function closeApp(appName, event) {
            event.stopPropagation();
            if (appName === 'home') return;
            const appElement = document.getElementById(`app-${appName}`);
            const navButton = document.getElementById(`nav-${appName}`);
            switch (appName) {
                case 'youtube':
                    if (window.displayedVideoIds) window.displayedVideoIds.clear();
                    if (window.prevPageTokens) window.prevPageTokens = [];
                    window.nextPageToken = '';
                    window.currentQuery = '';
                    const searchResults = document.getElementById('searchResults');
                    if (searchResults) searchResults.innerHTML = '';
                    const videoPlayer = document.getElementById('videoPlayer');
                    if (videoPlayer) videoPlayer.innerHTML = '';
                    const searchQuery = document.getElementById('searchQuery');
                    if (searchQuery) searchQuery.value = '';
                    const videoIdInput = document.getElementById('videoIdInput');
                    if (videoIdInput) videoIdInput.value = '';
                    const backButton = document.getElementById('backButton');
                    if (backButton) backButton.disabled = true;
                    const nextButton = document.getElementById('nextButton');
                    if (nextButton) nextButton.disabled = false;
                    window.appInitialized['youtube'] = false;
                    if (navButton) navButton.classList.remove('has-close');
                    break;
                case 'HEXA':
                    const hexaFrame = document.getElementById('HEXAFrame');
                    if (hexaFrame) hexaFrame.src = 'about:blank';
                    window.appInitialized['HEXA'] = false;
                    if (navButton) navButton.classList.remove('has-close');
                    break;
                case 'games':
                    const gamesFrame = document.getElementById('gamesFrame');
                    if (gamesFrame) gamesFrame.src = 'about:blank';
                    window.appInitialized['games'] = false;
                    if (navButton) navButton.classList.remove('has-close');
                    break;
                case 'websites':
                    const webFrame = document.getElementById('webFrame');
                    if (webFrame) webFrame.src = 'about:blank';
                    const urlInput = document.getElementById('urlInput');
                    if (urlInput) urlInput.value = '';
                    const errorMessage = document.getElementById('errorMessage');
                    if (errorMessage) errorMessage.style.display = 'none';
                    // --- NEW: Remove Website Loader dark mode class on close ---
                    if (document.getElementById('app-websites').classList.contains('website-loader-dark')) {
                        document.getElementById('app-websites').classList.remove('website-loader-dark');
                        localStorage.removeItem('websiteLoaderDarkMode'); // Optionally remove from storage on close
                    }
                    // --- END NEW ---
                    // Remove the website loader active class when closing
                    const mainContent = document.querySelector('.main-content');
                    if (mainContent) mainContent.classList.remove('website-loader-active');
                    window.appInitialized['websites'] = false;
                    if (navButton) navButton.classList.remove('has-close');
                    break;
                case 'spotify':
                    const spotifyFrame = document.getElementById('spotifyFrame');
                    if (spotifyFrame) spotifyFrame.src = 'about:blank';
                    window.appInitialized['spotify'] = false;
                    if (navButton) navButton.classList.remove('has-close');
                    break;
                case 'messages':
                    const messagesFrame = document.getElementById('messagesFrame');
                    if (messagesFrame) messagesFrame.src = 'about:blank';
                    window.appInitialized['messages'] = false;
                    if (navButton) navButton.classList.remove('has-close');
                    break // Added cleanup for messages app
            }
            if (appElement && appElement.classList.contains('active')) {
                appElement.classList.remove('active');
                if (navButton) navButton.classList.remove('active');
                showApp('home');
            }
        }

        function triggerPanic() {
            window.location.href = 'https://classroom.google.com/h';
        }

        var nextPageToken = '';
        var prevPageTokens = [];
        var MAX_DISPLAYED_IDS = parseInt(localStorage.getItem('maxDisplayedIds')) || 100;
        var MAX_PREV_TOKENS = parseInt(localStorage.getItem('maxPrevTokens')) || 10;
        var displayedVideoIds = new Set();
        var currentQuery = '';

        function displayVideos(videos) {
            var searchResultsContainer = document.getElementById('searchResults');
            searchResultsContainer.innerHTML = '';
            videos.forEach(video => {
                var videoId = video.id.videoId || video.id;
                var videoTitle = video.snippet.title;
                var videoDescription = video.snippet.description;
                var thumbnailUrl = video.snippet.thumbnails.medium.url;
                if (!displayedVideoIds.has(videoId)) {
                    if (displayedVideoIds.size >= MAX_DISPLAYED_IDS) {
                        const firstId = displayedVideoIds.values().next().value;
                        if (firstId) displayedVideoIds.delete(firstId);
                    }
                    displayedVideoIds.add(videoId);
                    var videoElement = document.createElement('div');
                    videoElement.classList.add('video-item');
                    videoElement.innerHTML = `<div class="video-thumbnail"><img src="${thumbnailUrl}" alt="${videoTitle}"></div><div class="video-details"><h3 class="video-title">${videoTitle}</h3><p class="video-description">${videoDescription}</p></div>`;
                    videoElement.addEventListener('click', function() {
                        // Hide the paste form when a video is clicked
                        var pasteForm = document.querySelector('.video-paste-form');
                        if (pasteForm) {
                            pasteForm.style.display = 'none';
                            pasteForm.style.visibility = 'hidden';
                            pasteForm.style.position = 'absolute';
                            pasteForm.style.left = '-9999px';
                        }
                        embedVideo(videoId);
                    });
                    searchResultsContainer.appendChild(videoElement);
                }
            });
            // Show the paste form when displaying suggested videos
            var pasteForm = document.querySelector('.video-paste-form');
            if (pasteForm) {
                pasteForm.style.display = 'flex';
                pasteForm.style.visibility = 'visible';
                pasteForm.style.position = 'static';  // Reset position to normal flow
                pasteForm.style.left = 'auto';  // Reset left position
            }
            document.getElementById('backButton').disabled = prevPageTokens.length === 0;
        }

        function embedVideo(videoId) {
            var searchResultsContainer = document.getElementById('searchResults');
            searchResultsContainer.innerHTML = '';
            var videoPlayerContainer = document.getElementById('videoPlayer');
            videoPlayerContainer.innerHTML = `<div class="embed-container"><iframe src="https://www.yout-ube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`;
            document.getElementById('backButton').style.display = 'none';
            document.getElementById('nextButton').style.display = 'none';
            // Hide the paste form when a video is embedded to prevent overlap with video player
            var pasteForm = document.querySelector('.video-paste-form');
            if (pasteForm) {
                pasteForm.style.display = 'none';
                pasteForm.style.visibility = 'hidden';
                pasteForm.style.position = 'absolute';
                pasteForm.style.left = '-9999px';  // Move it off-screen as extra assurance
            }
        }

        // Removed like button functionality to conserve API tokens

        function playVideoFromInput() {
            var input = document.getElementById('videoIdInput').value.trim();
            var videoId = extractVideoId(input);
            if (videoId) {
                embedVideo(videoId);
                // Hide the paste form when a video is played from input
                var pasteForm = document.querySelector('.video-paste-form');
                if (pasteForm) {
                    pasteForm.style.display = 'none';
                    pasteForm.style.visibility = 'hidden';
                    pasteForm.style.position = 'absolute';
                    pasteForm.style.left = '-9999px';
                }
            }
            else alert('Please enter a valid YouTube URL or video ID');
        }

        function extractVideoId(url) {
            var patterns = [
                /(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?\/(?:embed\/|watch\?v=|v\/|\/)?([^\s&]+)/,
                /^([A-Za-z0-9_-]{11})$/
            ];
            for (var pattern of patterns) {
                var match = url.match(pattern);
                if (match) return match[1];
            }
            return null;
        }

        function searchVideos() {
            var searchQuery = document.getElementById('searchQuery').value;
            if (searchQuery) {
                currentQuery = searchQuery;
                nextPageToken = '';
                prevPageTokens = [];
                displayedVideoIds.clear();
                // Show the paste form when performing a new search
                var pasteForm = document.querySelector('.video-paste-form');
                if (pasteForm) {
                    pasteForm.style.display = 'flex';
                    pasteForm.style.visibility = 'visible';
                    pasteForm.style.position = 'static';  // Reset position to normal flow
                    pasteForm.style.left = 'auto';  // Reset left position
                }
                fetchVideos(searchQuery);
            } else alert('Please enter a search query');
        }

        function fetchVideos(searchQuery) {
            fetch(`https://www.googleapis.com/youtube/v3/search?q=${searchQuery}&part=snippet&type=video&maxResults=8&pageToken=${nextPageToken}&key=${getCurrentApiKey()}`)
                .then(response => response.json())
                .then(data => {
                    if (nextPageToken) {
                        if (prevPageTokens.length >= MAX_PREV_TOKENS) prevPageTokens.shift();
                        prevPageTokens.push(nextPageToken);
                    }
                    nextPageToken = data.nextPageToken;
                    displayVideos(data.items);
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                    // If the current key fails, try the next one
                    if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                        console.log('API request failed, rotating key...');
                        rotateApiKey();
                        // Retry the request with the new key
                        fetch(`https://www.googleapis.com/youtube/v3/search?q=${searchQuery}&part=snippet&type=video&maxResults=8&pageToken=${nextPageToken}&key=${getCurrentApiKey()}`)
                            .then(response => response.json())
                            .then(data => {
                                if (nextPageToken) {
                                    if (prevPageTokens.length >= MAX_PREV_TOKENS) prevPageTokens.shift();
                                    prevPageTokens.push(nextPageToken);
                                }
                                nextPageToken = data.nextPageToken;
                                displayVideos(data.items);
                            })
                            .catch(error => console.error('Error fetching search results after key rotation:', error));
                    } else {
                        console.error('Error fetching search results:', error);
                    }
                });
        }

        function loadMoreVideos() {
            if (nextPageToken) fetchVideos(currentQuery);
        }

        function loadPreviousVideos() {
            if (prevPageTokens.length > 0) {
                nextPageToken = prevPageTokens.pop();
                fetchVideos(currentQuery);
            }
        }

        function loadWebsite() {
            var url = document.getElementById('urlInput').value.trim();
            if (!url) {
                alert("Please enter a valid URL.");
                return;
            }
            if (!/^https?:\/\//i.test(url)) url = 'http://' + url;
            document.getElementById('webFrame').src = url;
            hideErrorMessage();
            checkUrl(url);
        }

        function checkUrl(url) {
            const iframe = document.getElementById('webFrame');
            iframe.onload = function() {
                hideErrorMessage();
            };
            iframe.onerror = function() {
                showErrorMessage();
            };
            iframe.src = url;
        }

        function saveWebsite() {
            var url = document.getElementById('urlInput').value.trim();
            if (!url) {
                alert("Please enter a valid URL.");
                return;
            }
            if (!/^https?:\/\//i.test(url)) url = 'http://' + url;
            
            // Prompt user for website name
            let defaultName = new URL(url).hostname.replace('www.', '');
            let name = prompt("Enter a name for this website:", defaultName);
            
            // If user cancels the prompt, don't save the website
            if (name === null) {
                return;
            }
            
            // If user enters an empty name, use the default name
            if (name.trim() === "") {
                name = defaultName;
            }
            
            let savedUrls = JSON.parse(localStorage.getItem('savedUrls')) || [];
            // Check if URL already exists in the array
            let urlExists = false;
            for (let i = 0; i < savedUrls.length; i++) {
                if (savedUrls[i].url === url) {
                    urlExists = true;
                    break;
                }
            }
            if (!urlExists) {
                savedUrls.push({url: url, name: name.trim()});
                localStorage.setItem('savedUrls', JSON.stringify(savedUrls));
                updateSavedUrls();
            } else alert("This website is already saved.");
        }

        function updateSavedUrls() {
            let savedUrls = JSON.parse(localStorage.getItem('savedUrls')) || [];
            // Migrate old format (string array) to new format (object array) if needed
            let needsUpdate = false;
            savedUrls = savedUrls.map(item => {
                if (typeof item === 'string') {
                    // Old format - convert to new format
                    let hostname = new URL(item).hostname;
                    let defaultName = hostname.replace('www.', '');
                    needsUpdate = true;
                    return {url: item, name: defaultName};
                } else if (typeof item === 'object' && item.url) {
                    // New format - ensure name exists
                    if (!item.name) {
                        let hostname = new URL(item.url).hostname;
                        item.name = hostname.replace('www.', '');
                        needsUpdate = true;
                    }
                    return item;
                } else {
                    // Invalid format - skip
                    return null;
                }
            }).filter(item => item !== null);
            
            if (needsUpdate) {
                localStorage.setItem('savedUrls', JSON.stringify(savedUrls));
            }
            
            let urlList = document.getElementById('urlList');
            urlList.innerHTML = '';
            savedUrls.forEach((item, index) => {
                let url = item.url;
                let name = item.name || url; // Use custom name if available, otherwise use URL
                let listItem = document.createElement('li');
                listItem.classList.add('url-item');
                // Make the entire container clickable with event delegation
                listItem.innerHTML = `<div class="url-item-container" style="display: flex; justify-content: space-between; align-items: center; width: 100%; cursor: pointer;" data-url="${url}">
                    <button onclick="deleteWebsite(${index}); event.stopPropagation();" style="margin-right: 10px;">Delete</button>
                    <span style="flex: 1; text-align: center; padding: 0 10px;">${name}</span>
                    <button onclick="downloadWebsite('${url}', '${name}'); event.stopPropagation();" title="Download" style="background: transparent; border: 0; padding: 4px 6px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-weight: 500; min-width: 40px; transition: all 0.2s ease; margin-right: 5px;">â¬‡ï¸</button>
                    <button onclick="renameWebsite(${index}); event.stopPropagation();" title="Rename" style="background: transparent; border: 0; padding: 4px 6px; border-radius: 4px; cursor: pointer; font-size: 0.7rem; font-weight: 500; min-width: 40px; transition: all 0.2s ease;">âœŽ</button>
                </div>`;
                // Add click event to load the website when any part of the container is clicked (except buttons)
                listItem.querySelector('.url-item-container').addEventListener('click', function(e) {
                    // Only load website if the click was not on a button
                    if (e.target.tagName !== 'BUTTON') {
                        loadSavedWebsite(url);
                    }
                });
                urlList.appendChild(listItem);
            });
            document.getElementById('savedUrls').style.display = savedUrls.length ? 'block' : 'none';
        }

        function loadSavedWebsite(url) {
            document.getElementById('urlInput').value = url;
            document.getElementById('webFrame').src = url;
        }
        
        function renameWebsite(index) {
            let savedUrls = JSON.parse(localStorage.getItem('savedUrls')) || [];
            if (index >= 0 && index < savedUrls.length) {
                let currentName = savedUrls[index].name || savedUrls[index].url;
                let newName = prompt("Enter a new name for this website:", currentName);
                if (newName !== null && newName.trim() !== "") {
                    savedUrls[index].name = newName.trim();
                    localStorage.setItem('savedUrls', JSON.stringify(savedUrls));
                    updateSavedUrls();
                }
            }
        }

        function deleteWebsite(index) {
            let savedUrls = JSON.parse(localStorage.getItem('savedUrls')) || [];
            savedUrls.splice(index, 1);
            localStorage.setItem('savedUrls', JSON.stringify(savedUrls));
            updateSavedUrls();
        }
        
        function downloadWebsite(url, name) {
            // Get the template content
            let template = `<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>(name of website)</title> <!-- Adding the favicon --> <link rel="icon" href="https://cdn.creazilla.com/icons/3232649/unblock-icon-sm.png" type="image/x-icon"> <style> html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; /* Prevents scrolling */ } #iframeContainer { width: 100%; height: 100%; } iframe { width: 100%; height: 100%; border: none; /* Removes the border */ } </style> </head> <body> <div id="iframeContainer"> <iframe id="webFrame" src="(Link to website)"></iframe> </div> </body> </html>`;
            
            // Replace placeholders with actual values
            let htmlContent = template.replace('(name of website)', name).replace('(Link to website)', url);
            
            // Create a Blob with the HTML content
            let blob = new Blob([htmlContent], { type: 'text/html' });
            
            // Create a download link
            let link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = name + '.html'; // Use website name as filename
            
            // Trigger the download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function toggleFullScreen() {
            var iframe = document.getElementById('iframeContainer');
            if (iframe.requestFullscreen) iframe.requestFullscreen();
            else if (iframe.mozRequestFullScreen) iframe.mozRequestFullScreen();
            else if (iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
            else if (iframe.msRequestFullscreen) iframe.msRequestFullscreen();
        }

        function showErrorMessage() {
            document.getElementById('errorMessage').style.display = 'block';
        }

        function hideErrorMessage() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        function loadMessagesWebsite() {
            var url = document.getElementById('messagesUrlInput').value.trim();
            if (!url) {
                alert("Please enter a valid URL.");
                return;
            }
            if (!/^https?:\/\//i.test(url)) url = 'http://' + url;
            document.getElementById('messagesFrame').src = url;
            hideMessagesErrorMessage();
            checkMessagesUrl(url);
        }

        function checkMessagesUrl(url) {
            const iframe = document.getElementById('messagesFrame');
            iframe.onload = function() {
                hideMessagesErrorMessage();
            };
            iframe.onerror = function() {
                showMessagesErrorMessage();
            };
            iframe.src = url;
        }

        function saveMessagesWebsite() {
            var url = document.getElementById('messagesUrlInput').value.trim();
            if (!url) {
                alert("Please enter a valid URL.");
                return;
            }
            if (!/^https?:\/\//i.test(url)) url = 'http://' + url;
            let savedMessagesUrls = JSON.parse(localStorage.getItem('savedMessagesUrls')) || [];
            if (!savedMessagesUrls.includes(url)) {
                savedMessagesUrls.push(url);
                localStorage.setItem('savedMessagesUrls', JSON.stringify(savedMessagesUrls));
                updateMessagesSavedUrls();
            } else alert("This messages site is already saved.");
        }

        function updateMessagesSavedUrls() {
            let savedMessagesUrls = JSON.parse(localStorage.getItem('savedMessagesUrls')) || [];
            let urlList = document.getElementById('messagesUrlList');
            urlList.innerHTML = '';
            savedMessagesUrls.forEach((url, index) => {
                let listItem = document.createElement('li');
                listItem.classList.add('url-item');
                listItem.innerHTML = `<a href="#" onclick="loadMessagesSavedWebsite('${url}'); return false;">${url}</a> <button onclick="deleteMessagesWebsite(${index})">Delete</button>`;
                urlList.appendChild(listItem);
            });
        }

        function loadMessagesSavedWebsite(url) {
            document.getElementById('messagesUrlInput').value = url;
            document.getElementById('messagesFrame').src = url;
        }

        function deleteMessagesWebsite(index) {
            let savedMessagesUrls = JSON.parse(localStorage.getItem('savedMessagesUrls')) || [];
            savedMessagesUrls.splice(index, 1);
            localStorage.setItem('savedMessagesUrls', JSON.stringify(savedMessagesUrls));
            updateMessagesSavedUrls();
        }

        function showMessagesErrorMessage() {
            document.getElementById('messagesErrorMessage').style.display = 'block';
        }

        function hideMessagesErrorMessage() {
            document.getElementById('messagesErrorMessage').style.display = 'none';
        }

        (function() {
            document.addEventListener('DOMContentLoaded', function() {
                let runnerInitialized = false;
                const fileTabButtons = document.querySelectorAll('.settings-tab-button[data-tab="file"]');
                fileTabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        document.querySelectorAll('.settings-tab-button').forEach(btn => btn.classList.remove('active'));
                        document.querySelectorAll('.settings-panel').forEach(panel => panel.classList.remove('active'));
                        button.classList.add('active');
                        const tabName = button.getAttribute('data-tab');
                        document.getElementById(`${tabName}-settings-panel`).classList.add('active');
                        if (!runnerInitialized && tabName === 'file') {
                            initCodeRunner();
                            runnerInitialized = true;
                        }
                    });
                });

                function initCodeRunner() {
                    loadSavedCodeRunner();
                    runCodeRunner();
                    document.getElementById('run-btn-runner').addEventListener('click', runCodeRunner);
                    document.getElementById('clear-btn-runner').addEventListener('click', clearAllRunner);
                    document.getElementById('save-btn-runner').addEventListener('click', saveCodeToBrowserRunner);
                    document.getElementById('save-file-btn-runner').addEventListener('click', saveCodeToFileRunner);
                    document.addEventListener('keydown', function(event) {
                        if (event.ctrlKey && event.key === 'Enter' && document.getElementById('file-settings-panel').classList.contains('active')) runCodeRunner();
                    });
                }

                function runCodeRunner() {
                    const htmlCode = document.getElementById('html-code-runner').value;
                    const previewFrame = document.getElementById('preview-frame-runner');
                    const fullHtml = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview</title>
</head>
<body>
    ${htmlCode}
</body>
</html>
                    `;
                    previewFrame.srcdoc = fullHtml;
                }

                function clearAllRunner() {
                    if (confirm('Are you sure you want to clear all code in the runner?')) {
                        document.getElementById('html-code-runner').value = '';
                        const previewFrame = document.getElementById('preview-frame-runner');
                        previewFrame.srcdoc = '';
                    }
                }

                function saveCodeToBrowserRunner() {
                    localStorage.setItem('htmlCodeRunner', document.getElementById('html-code-runner').value);
                    alert('Code saved to browser storage successfully!');
                }

                function saveCodeToFileRunner() {
                    const htmlCode = document.getElementById('html-code-runner').value;
                    let fullHtml = `<!DOCTYPE html>
<html>
<head>
    <title>My Web Page</title>
</head>
<body>
${htmlCode}
</body>
</html>`;
                    const blob = new Blob([fullHtml], { type: 'text/html' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = 'my-webpage.html';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    alert('HTML file saved successfully!');
                }

                function loadSavedCodeRunner() {
                    const savedHtml = localStorage.getItem('htmlCodeRunner');
                    if (savedHtml) document.getElementById('html-code-runner').value = savedHtml;
                }
            });
        })();

        document.getElementById('settingsButton').addEventListener('click', openSettings);

        function toggleFullscreen() {
            const runnerContainer = document.querySelector('.code-runner-container');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            if (!document.fullscreenElement) {
                if (runnerContainer.requestFullscreen) {
                    runnerContainer.requestFullscreen();
                    fullscreenBtn.textContent = 'âœ•';
                } else if (runnerContainer.mozRequestFullScreen) {
                    runnerContainer.mozRequestFullScreen();
                    fullscreenBtn.textContent = 'âœ•';
                } else if (runnerContainer.webkitRequestFullscreen) {
                    runnerContainer.webkitRequestFullscreen();
                    fullscreenBtn.textContent = 'âœ•';
                } else if (runnerContainer.msRequestFullscreen) {
                    runnerContainer.msRequestFullscreen();
                    fullscreenBtn.textContent = 'âœ•';
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenBtn.textContent = 'â›¶';
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                    fullscreenBtn.textContent = 'â›¶';
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                    fullscreenBtn.textContent = 'â›¶';
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                    fullscreenBtn.textContent = 'â›¶';
                }
            }
        }
    </script>

    </body>
    </html>
